<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models • Pmetrics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="models_files/libs/quarto-html/popper.min.js"></script><script src="models_files/libs/quarto-html/tippy.umd.min.js"></script><link href="models_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="models_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link rel="stylesheet" href="Styles/style.css">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/pmetrics.html">Start Here</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/data.html">Data Objects</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Model Objects</a></li>
    <li><a class="dropdown-item" href="../articles/running.html">Running the fit</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">Created Objects</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/pta.html">Probability of Target Attainment</a></li>
    <li><a class="dropdown-item" href="../articles/plotly.html">Plotly plots</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LAPKB/Pmetrics_rust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Models</h1>




      <small class="dont-index">Source: <a href="https://github.com/LAPKB/Pmetrics_rust/blob/main/vignettes/models.qmd" class="external-link"><code>vignettes/models.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2" data-number="1"><h2 data-number="1" id="introduction">
<span class="header-section-number">1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="https://lapkb.github.io/Pmetrics/reference/PM_model.html" class="external-link"><code>PM_model</code></a> objects are one of two fundamental objects in Pmetrics, along with <a href="https://lapkb.github.io/Pmetrics/reference/PM_data.html" class="external-link"><code>PM_data</code></a> objects. Defining a <code>PM_model</code> allows for fitting it to the data via the <code>$fit()</code> method to conduct a population analysis, i.e. estimating the probability distribution of model equation parameter values in the population.</p>
</section><section class="level2" data-number="2"><h2 data-number="2" id="creating-models">
<span class="header-section-number">2</span> Creating Models<a class="anchor" aria-label="anchor" href="#creating-models"></a>
</h2>
<p>There are three pathways to creating models in Pmetrics.</p>
<ul>
<li>Use the new Pmetrics Model Builder app, coming soon. The Shiny app is retired.</li>
<li>Write a model list in R</li>
<li>Load an existing model text file</li>
</ul>
<p>Each of these use sections to define the model. In the app, the sections correspond to tabs. In the list, they are named elements. In the model file, they are code blocks delimited by “#” and the name of the block. The sections are largely the same across the three model pathways, and we’ll cover the details in this document.</p>
<section class="level3" data-number="2.1"><h3 data-number="2.1" id="create-a-model-with-the-app">
<span class="header-section-number">2.1</span> Create a model with the app<a class="anchor" aria-label="anchor" href="#create-a-model-with-the-app"></a>
</h3>
<p>Coming soon.</p>
<!-- To launch the app, type the following into your console:


::: {.cell}

:::


You can supply a `PM_data` and/or a `PM_model` as optional arguments to the function, e.g. `PM_model$new(dataEx)` or `PM_model$new(modEx)` or even `PM_model$new(dataEx, modEx)`. The order of data and/or model arguments doesn't matter. Pmetrics can figure out which is which. -->
</section><section class="level3" data-number="2.2"><h3 data-number="2.2" id="create-a-model-as-a-list-in-r">
<span class="header-section-number">2.2</span> Create a model as a list in R<a class="anchor" aria-label="anchor" href="#create-a-model-as-a-list-in-r"></a>
</h3>
<p>You can write a Pmetrics model list in R. Blocks in the model files which are delimited with the “#” character in the file become elements of the list in R6. <!-- You can also generate a model in the app and copy it as a list to R which can be used in `PM_model$new(<copied_list>)`.  --> Once in R, <code>PM_model</code> list objects can be updated using the <code>$update()</code> <a href="#update-model">method</a>.</p>
<p>The list elements are the building blocks for the model. Building blocks are of two types:</p>
<ul>
<li>
<strong>Block elements: Lists</strong> define <em>primary parameters</em>, <em>covariates</em>, and <em>error models</em>. These portions of the model are lists of specific creator functions and no additional R code is permissible. They take this form:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> </span>
<span>    var1 <span class="op">=</span> <span class="fu">creator</span><span class="op">(</span><span class="op">)</span>,   </span>
<span>    var2 <span class="op">=</span> <span class="fu">creator</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="va">...</span> <span class="co"># more creators</span></span>
<span><span class="op">)</span> <span class="co"># close the list</span></span></code></pre></div>
</div>
<p>Note the comma separating the creator functions, <code>list(</code> to open the list and <code>)</code> to close the list. Names are case-insensitive and are converted to lowercase for Rust.</p>
<ul>
<li>
<strong>Block elements: functions</strong> define the other parts of the model, including <em>secondary (global) equations</em>, <em>model equations</em> (e.g. ODEs), <em>lag time</em>, <em>bioavailability</em>, <em>initial conditions</em>, and <em>outputs</em>. These parts of the model are defined as R functions without arguments, but whose body contains any permissible R code.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block_name</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> </span>
<span></span>
<span>          <span class="co"># any valid R code </span></span>
<span>          <span class="co"># can use primary or secondary parameters and covariates</span></span>
<span>          <span class="co"># lines are not separated by commas</span></span>
<span>      </span>
<span><span class="op">}</span> <span class="co"># end function and block</span></span></code></pre></div>
</div>
<p>Note the absence of arguments between the <code>()</code>, the opening curly brace <code>{</code> to start the function body and the closing curly brace “<code>}</code>” to end the body. Again, all R code will be converted to lowercase prior to translation into Rust.</p>
<p><strong>Important:</strong> All models must have <code>pri</code>, <code>eqn</code>, <code>out</code>, and <code>err</code> blocks.</p>
</section><section class="level3" data-number="2.3"><h3 data-number="2.3" id="model-files">
<span class="header-section-number">2.3</span> Model Files<a class="anchor" aria-label="anchor" href="#model-files"></a>
</h3>
<p>The format of the .txt model file has been mostly unchanged since Pmetrics 0.4, and they are created by hand. <!-- You can write the file by hand, or use the app to create a model and then save it to a file.  --> Once you have a file, it can be loaded in to R with <code>PM_model$new("file")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"model.txt"</span><span class="op">)</span> </span>
<span><span class="co"># assumes model.txt is in working directory</span></span>
<span><span class="co"># check with list.files() and/or getwd()</span></span></code></pre></div>
</div>
<p>Saved models are only text files. You can write files directly yourself, although it is easier and more stable to use the model building app. We will review the format of the files in detail.</p>
<p><strong>Naming your model files.</strong> The default model file name is “model.txt,” but you can call them whatever you wish. When you use a model file in a <code>$fit()</code> method, at the end of the run, your original model file will be left where it is, but a copy called “genmodel.txt” will be in the /inputs subfolder of the run folder.</p>
<p><strong>Structure of model files.</strong> The model file is a text file with up to 11 blocks, each marked by “#” followed by a header tag. For each header, only the capital letters are required for recognition by Pmetrics. The blocks can be in any order, and header names are case-insensitive (i.e. the capitalization here is just to show which letters are required). We include a <a href="#completeEx">complete example</a>.</p>
<p>Comments: You can insert comments into your model text file by starting a line with a capital “C” followed by a space. These lines will be removed/ignored in the final Rust code.</p>
</section></section><section class="level2" data-number="3"><h2 data-number="3" id="model-blocks">
<span class="header-section-number">3</span> Model Blocks<a class="anchor" aria-label="anchor" href="#model-blocks"></a>
</h2>
<!-- *Note*: The model building app has a unique [Model library](#mb-lib) section not found in model files or lists. -->
<p>Blocks common to all the model building pathways include the following. The capital letters are the shorthand way to designate the blocks in the model text files or in the R list format.</p>
<ul>
<li><a href="#mb-pri">PRImary variables</a></li>
<li><a href="#mb-cov">COVariates</a></li>
<li><a href="#mb-sec">SECcondary variables</a></li>
<li><a href="#mb-ini">INItial conditions</a></li>
<li><a href="#mb-fa">FA (bioavailability)</a></li>
<li><a href="#mb-lag">LAG time</a></li>
<li><a href="#mb-eqn">EQuatioNs</a></li>
<li><a href="#mb-out">OUTputs</a></li>
<li><a href="#mb-err">ERRors</a></li>
</ul>
<section class="level3" data-number="3.1"><h3 data-number="3.1" id="mb-lib">
<span class="header-section-number">3.1</span> Model Library<a class="anchor" aria-label="anchor" href="#mb-lib"></a>
</h3>
<!--
![](Images/model_builder/front.png)

Here you can choose from pre-existing models, either which you have created yourself and load with the Previous Model dialogue, or from the Pmetrics Model Library. Use the filters and description search to help select the model you want. Matching models will update in the box at the bottom. If you select one, you'll see a model snapshot on the right.

In the snapshots, B is for bolus inputs, R is for Rate infusions (e.g. intravenous infusions), and Y is for observations. Arrows indicate the flow of drug. The grey compartment 0 is the environment.

Once you choose a model, hit the "Select" button at the bottom to populate remaining model components. Similarly, if you load a Previous Model, model components will be appropriately populated. -->
<p>You can access the Pmetrics Model Library programmatically using the <a href="https://lapkb.github.io/Pmetrics/reference/model_lib.html" class="external-link"><code>model_lib</code></a> function. This function returns a data frame of available models with their characteristics, including the model name to be used in the <code>EQN</code> block, number of compartments, number of inputs and outputs, and a brief description.</p>
<p>All of the models are pre-loaded as R6 objects. You can get details of the model by simply typing its primary name from the table into the console. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">two_comp_bolus</span></span></code></pre></div>
</div>
</section><section class="level3" data-number="3.2"><h3 data-number="3.2" id="mb-pri">
<span class="header-section-number">3.2</span> PRImary<a class="anchor" aria-label="anchor" href="#mb-pri"></a>
</h3>
<section class="level4" data-number="3.2.1"><h4 data-number="3.2.1" id="app">
<span class="header-section-number">3.2.1</span> App<a class="anchor" aria-label="anchor" href="#app"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/primary.png)

In this tab, you can choose the number and names of the primary parameters. Some variable names are [reserved](#reserved) for use by Pmetrics and cannot be used as primary variable names.

These are the parameters for which value probability distributions will be estimated. You can specify initial values as ranges or mean/SD. The mean is the mid point of a range and the SD is 1/6 of the range, i.e. 3 SD above and below the mean.

In Legacy Pmetrics it was possible to specify parameters as either fixed to a known value in the entire population (constant) or fixed to some unknown value in the population (fixed but unknown). To make parameters constant in Pmetrics ≥ 3.0, simply include the value in either the #SECondary block or in the equations directly. Because the Legacy optimization process was very suboptimal and expensive for fixed but unknown parameters, we have removed it in Pmetrics ≥ 3.0. To accomplish this, we suggest including such a parameter as a typical random parameter, and then fixing it to a constant value after inspecting the results of a satisfactory run when the parameter was random.

In the bottom you see the Model Diagram and the Model List. These dynamically build as you complete the Model Components. -->
</section><section class="level4" data-number="3.2.2"><h4 data-number="3.2.2" id="list">
<span class="header-section-number">3.2.2</span> List<a class="anchor" aria-label="anchor" href="#list"></a>
</h4>
<p>Primary variables are defined in a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>. The list is named “pri”, and is comprised of named elements which are the parameters, and the creator function to define each parameter, one parameter to a line.</p>
<p>The two creator functions for primary parameters are <code>ab</code> and <code>msd</code>. Choose one for each parameter. The first defines the absolute search space for that parameter for NPAG/NPOD, i.e., the range. <code>msd</code> is the companion function that specifies the range using a mean and standard deviation (SD), assuming the mean is the midpoint of the range, and the SD equals 1/6th of the range, i.3., there are 3 SD above and below the mean, covering 99.7% of the prior distribution. <!-- For IT2B/RPEM, it defines the mean of the prior as the midpoint  --> <!-- of the range, and the range covers 6 standard deviations, e.g. ±3 SD above and  --> <!-- below the mean, or 99.7% of the prior distribution. `msd` is the companion  --> <!-- function that specifies a mean and SD in IT2B and RPEM.  --> <!-- For NPAG/NPOD, it will be converted in to a range in the reverse fashion as --> <!-- described for `ab`.  --></p>
<!-- For both specifying functions, `gtz` is an argument to -->
<!-- force the parameter value to be positive, i.e. `gtz=T`, which is the default. -->
<!-- To allow negative parameters, set `gtz=F`. -->
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, <span class="co"># mean will be 2.5, SD = 5/6 = 0.83</span></span>
<span>    V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">20</span><span class="op">)</span> <span class="co"># range will be 100 ± 3*20, i.e. [40, 160]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level4" data-number="3.2.3"><h4 data-number="3.2.3" id="file">
<span class="header-section-number">3.2.3</span> File<a class="anchor" aria-label="anchor" href="#file"></a>
</h4>
<p>Primary variables are a list of variable names, one name to a line. On each line, following the variable name, is the range for the parameter that defines the search space. These ranges behave slightly differently for NPAG and the simulator.</p>
<ul>
<li><p>For all engines, the format of the limits is <em>min, max</em>.</p></li>
<li><p>For <strong>NPAG/NPOD</strong>, when <em>min, max</em> limits are specified, they are absolute, i.e. the algorithm will not search outside this range.</p></li>
</ul>
<!-- - For **IT2B**, the range defines the Bayesian prior distribution of --><!--     the parameter values for cycle 1. For each parameter, the mean of --><!--     the Bayesian prior distribution is taken as the middle of the range, --><!--     and the standard deviation is *xsig*\*range (see [[IT2B --><!--     runs]{.underline}](\l)). Adding a plus sign (+) to a line will --><!--     prevent that parameter from being assigned negative values. NPAG and --><!--     the simulator will ignore the pluses as the ranges are absolute for --><!--     these engines. Note that prior to version 1.5.0, this used to be an --><!--     exclamation point (!) but to be consistent throughout the model --><!--     file, the exclamation point is now used when fixed values are --><!--     desired. --><ul>
<li>The <strong>simulator</strong> will ignore the ranges with the default value of NULL for the <code>limits</code> argument to <a href="https://lapkb.github.io/Pmetrics/reference/PM_sim.html" class="external-link"><code>PM_sim</code></a>. If the simulator <code>limits</code> argument is set to NA, it will mean that these ranges will be used as the limits to truncate the <a href="simulation.html">simulation</a>.</li>
</ul>
<p>Example:</p>
<div class="script">
<p>#Pri<br>
KE, 0, 5<br>
V, 0.01, 100<br>
KA, 0, 5<br></p>
</div>
</section></section><section class="level3" data-number="3.3"><h3 data-number="3.3" id="mb-cov">
<span class="header-section-number">3.3</span> COVariates<a class="anchor" aria-label="anchor" href="#mb-cov"></a>
</h3>
<p>Covariates are subject-specific data, such as body weight, contained in the data. The covariate names, which are the column names in the data file or <code>PM_data</code> object, must be declared if used in the model object. Once declared, they can be used in secondary variable and differential equations. The names should be the same as in the data file.</p>
<p>By default, missing covariate values are linearly interpolated between existing values, or carried forward if the first value is the only non-missing entry. However, you can suppress interpolation and carry forward the previous value in a piece-wise constant fashion, depending on the way you define the model as described below.</p>
<section class="level4" data-number="3.3.1"><h4 data-number="3.3.1" id="app-1">
<span class="header-section-number">3.3.1</span> App<a class="anchor" aria-label="anchor" href="#app-1"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/covariates.png)

If you launch the Model Builder with a `PM_data` object as an argument, the covariate tab will be pre-populated with the covariates in the data file, as above. The same is true if you include a `PM_model` object as an argument to `PM_model$new()`. If you include both, the covariates in the `PM_data` object will take precedence. You can select any of them to make them piece-wise constant, i.e. the value is held constant between measurements. If left unchecked, covariate values will be linearly interpolated between measurements. -->
</section><section class="level4" data-number="3.3.2"><h4 data-number="3.3.2" id="list-1">
<span class="header-section-number">3.3.2</span> List<a class="anchor" aria-label="anchor" href="#list-1"></a>
</h4>
<p>The covariate element is a list whose names are the same as the covariates in the data file, and whose values are the <a href="https://lapkb.github.io/Pmetrics/reference/interp.html" class="external-link"><code>interp</code></a> creator function to declare how each covariate is interpolated between entries in the data.</p>
<p>The default argument for <code>interp</code> is “lm” which means that values will be linearly interpolated between entries, like the R linear model function <a href="https://rdrr.io/pkg/stats/man/lm.html" class="external-link"><code>lm</code></a>. The alternative is “none”, which holds the covariate value the same as the previous entry until it changes, i.e., a carry-forward strategy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      wt <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Here, <code>wt</code> will be linearly interpolated and <code>age</code> will be piece-wise constant, i.e. held constant until the next entry in the data file.</p>
</section><section class="level4" data-number="3.3.3"><h4 data-number="3.3.3" id="file-1">
<span class="header-section-number">3.3.3</span> File<a class="anchor" aria-label="anchor" href="#file-1"></a>
</h4>
<p>List the covariates by name, one per line in the #COV block. To make a covariate piece-wise constant, include an exclamation point (!) in the declaration line.</p>
<p><strong>Note</strong> that any covariate relationship to any parameter may be described as the user wishes by mathematical equations and R code, allowing for exploration of complex, non-linear, time-dependent, and/or conditional relationships. These equations are included in any of the blocks which are functions (SEC, EQN, INI, FA, LAG, OUT).</p>
<p>Example:</p>
<div class="script">
<p>#Cov<br>
wt<br>
cyp<br>
IC!</p>
</div>
<p>Here, IC will be piece-wise constant and the other two will be linearly interpolated for missing values.</p>
</section></section><section class="level3" data-number="3.4"><h3 data-number="3.4" id="mb-sec">
<span class="header-section-number">3.4</span> Secondary<a class="anchor" aria-label="anchor" href="#mb-sec"></a>
</h3>
<p>Secondary variables are those that are defined by equations that are combinations of primary, covariates, and other secondary variables. Pmetrics does <em>NOT</em> generate distributions for the values of secondary variables. They are only used internally to define the model. Variables declared in the secondary block are <strong><em>global</em></strong>, i.e., they are available to all other blocks. This is in contrast to variables declared within other function blocks (INI, FA, LAG, OUT), which are only available within the block they are declared.</p>
<section class="level4" data-number="3.4.1"><h4 data-number="3.4.1" id="app-2">
<span class="header-section-number">3.4.1</span> App<a class="anchor" aria-label="anchor" href="#app-2"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/secondary.png)

If using secondary variables, define them first within this tab. Equation syntax for Secondary equations must be R. Each expression must be on a new line and contain only variables which have been previously defined in the Primary, Covariate, or Secondary blocks.

The image shows examples of secondary variable declarations without conditions. Here are two examples of conditional secondary variables chosen on the basis of sex. The primary variables are Vm, Vf, CLm, and CLf.

```
V = Vm
if (sex == 1) V = Vf

V = Vm
CL = CLm
if(sex == 1) {
  V = Vf
  CL = CLf
}
``` -->
</section><section class="level4" data-number="3.4.2"><h4 data-number="3.4.2" id="list-2">
<span class="header-section-number">3.4.2</span> List<a class="anchor" aria-label="anchor" href="#list-2"></a>
</h4>
<p>Specify each variable equation as a list of unnamed character elements in the same way as for the app. In the example below, V0 is the primary parameter which will be estimated, but internally, the model uses V as V0*wt, unless age is &gt;18, in which case weight is capped at 75 kg. It’s the same for CL0. Note that the conditional statement is not named.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      CL0 <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V0 <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      wt <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sec <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">V</span> <span class="op">=</span> <span class="va">V0</span><span class="op">*</span><span class="va">wt</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span><span class="fl">18</span><span class="op">)</span> <span class="op">{</span><span class="va">V</span> <span class="op">=</span> <span class="va">V0</span> <span class="op">*</span> <span class="fl">75</span><span class="op">}</span></span>
<span>      <span class="va">CL</span> <span class="op">=</span> <span class="va">CL0</span> <span class="op">*</span> <span class="va">wt</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span> <span class="co"># end of $new()</span></span></code></pre></div>
</div>
</section><section class="level4" data-number="3.4.3"><h4 data-number="3.4.3" id="file-2">
<span class="header-section-number">3.4.3</span> File<a class="anchor" aria-label="anchor" href="#file-2"></a>
</h4>
<p>Format is the same as for equations in the list.</p>
<p>Example:</p>
<div class="script">
<p>#Sec<br>
CL = Ke * V * wt**0.75<br>
if (cyp &gt; 1) {CL = CL * cyp}</p>
</div>
</section></section><section class="level3" data-number="3.5"><h3 data-number="3.5" id="mb-ini">
<span class="header-section-number">3.5</span> INItial conditions<a class="anchor" aria-label="anchor" href="#mb-ini"></a>
</h3>
<p>By default, all model compartments have zero amounts at time 0. However, you can change the default initial condition of any compartment from 0 to something else. It can be an fixed value, primary or secondary variables, or covariate(s), or equations/conditionals based on these.</p>
<section class="level4" data-number="3.5.1"><h4 data-number="3.5.1" id="app-3">
<span class="header-section-number">3.5.1</span> App<a class="anchor" aria-label="anchor" href="#app-3"></a>
</h4>
<p>Coming soon. <!-- We'll discuss more about the interface in the section on [lag times](#mb-lag). --></p>
</section><section class="level4" data-number="3.5.2"><h4 data-number="3.5.2" id="list-3">
<span class="header-section-number">3.5.2</span> List<a class="anchor" aria-label="anchor" href="#list-3"></a>
</h4>
<p>Initial conditions can be changed as a function called “ini”. Each line of the function specifies the compartment amount as “X[.] = expression”, where “.” is the compartment number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in R syntax.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      IC3 <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      wt <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      IC2 <span class="op">=</span> <span class="fu"><a href="../reference/interp.html">interp</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    ini <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">IC2</span><span class="op">*</span><span class="va">V</span></span>
<span>      <span class="va">X</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">IC3</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span> <span class="co"># end of $new()</span></span></code></pre></div>
</div>
<p>In the example above, IC2 is a covariate with the measured trough concentration prior to an observed dose and IC3 is a fitted primary parameter specifying an initial amount in unobserved compartment 3.</p>
<p>In the first case, the initial condition for compartment 2 becomes the value of the IC2 covariate (defined in <code>cov</code> list) multiplied by the current estimate of V during each iteration. This is useful when a subject has been taking a drug as an outpatient, and comes in to the lab for PK sampling, with measurement of a concentration immediately prior to a witnessed dose, which is in turn followed by more sampling. In this case, IC2 or any other covariate can be set to the initial measured concentration, and if V is the volume of compartment 2, the initial condition (amount) in compartment 2 will now be set to the measured concentration of drug multiplied by the estimated volume for each iteration until convergence.</p>
<p>In the second case, the initial condition for compartment 3 becomes another variable, IC3 defined in the <code>pri</code> list, to fit in the model, given the observed data.</p>
</section><section class="level4" data-number="3.5.3"><h4 data-number="3.5.3" id="file-3">
<span class="header-section-number">3.5.3</span> File<a class="anchor" aria-label="anchor" href="#file-3"></a>
</h4>
<p>The same example as for the list above is shown below in the format for the file.</p>
<div class="script">
<p>#Ini<br>
X[2] = IC*V<br>
X[3] = IC3<br></p>
</div>
</section></section><section class="level3" data-number="3.6"><h3 data-number="3.6" id="mb-fa">
<span class="header-section-number">3.6</span> FA (bioavailability)<a class="anchor" aria-label="anchor" href="#mb-fa"></a>
</h3>
<p>In this tab you can change the default bioavailability of any bolus input from 1 to something else. It can be an equation, primary or secondary variable, or covariate.</p>
<section class="level4" data-number="3.6.1"><h4 data-number="3.6.1" id="app-4">
<span class="header-section-number">3.6.1</span> App<a class="anchor" aria-label="anchor" href="#app-4"></a>
</h4>
<p>Coming soon.</p>
<!-- We'll discuss more about the interface in the section on [lag times](#mb-lag). -->
</section><section class="level4" data-number="3.6.2"><h4 data-number="3.6.2" id="list-4">
<span class="header-section-number">3.6.2</span> List<a class="anchor" aria-label="anchor" href="#list-4"></a>
</h4>
<p>Bioavailability for any bolus input can be changed from the default value of 1. Use a function called “fa”, where each line is of the form “FA[.] = expression”, and “.” is the input number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      FA1 <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fa <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">FA</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">FA1</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level4" data-number="3.6.3"><h4 data-number="3.6.3" id="file-4">
<span class="header-section-number">3.6.3</span> File<a class="anchor" aria-label="anchor" href="#file-4"></a>
</h4>
<p>The same example as for the list above is shown below in the format for the file.</p>
<div class="script">
<p>#Fa<br>
FA[1] = FA1</p>
</div>
</section></section><section class="level3" data-number="3.7"><h3 data-number="3.7" id="mb-lag">
<span class="header-section-number">3.7</span> LAG time<a class="anchor" aria-label="anchor" href="#mb-lag"></a>
</h3>
<p>The lag time is a delay in absorption for a bolus input.</p>
<section class="level4" data-number="3.7.1"><h4 data-number="3.7.1" id="app-5">
<span class="header-section-number">3.7.1</span> App<a class="anchor" aria-label="anchor" href="#app-5"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/lag.png)

You can change the default delay in absorption of any bolus input from 0 to something else. It can be an equation, primary or secondary variable, or covariate. If you wish to use any of the latter three, select them from the drop down and the equation will pre-populate, as shown in the image. You can edit the equation or write your own equation. This is true for initial conditions and bioavailability in their tabs. -->
</section><section class="level4" data-number="3.7.2"><h4 data-number="3.7.2" id="list-5">
<span class="header-section-number">3.7.2</span> List<a class="anchor" aria-label="anchor" href="#list-5"></a>
</h4>
<p>Use a function called “lag”, each line of the form “LAG[.] = expression”, where “.” is the input number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      lag1 <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    lag <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">LAG</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">lag1</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level4" data-number="3.7.3"><h4 data-number="3.7.3" id="file-5">
<span class="header-section-number">3.7.3</span> File<a class="anchor" aria-label="anchor" href="#file-5"></a>
</h4>
<p>The same example as for the list above is shown below in the format for the file.</p>
<div class="script">
<p>#Lag<br>
LAG[1] = Tlag1</p>
</div>
</section></section><section class="level3" data-number="3.8"><h3 data-number="3.8" id="mb-eqn">
<span class="header-section-number">3.8</span> EQuatioNs<a class="anchor" aria-label="anchor" href="#mb-eqn"></a>
</h3>
<p>These are the equations that define the structural model, i.e., the mathematical expressions that relate input (dose) to output (measurements). Pmetrics has a library of models with algebraic solutions and models can also use differential equations in a format compatible with R. Even algebraic models will contain differential equations for purposes of understanding and plotting the model, but algebraic models from the library include a token which tells Pmetrics how to choose the correct model. Details below.</p>
<section class="level4" data-number="3.8.1"><h4 data-number="3.8.1" id="app-6">
<span class="header-section-number">3.8.1</span> App<a class="anchor" aria-label="anchor" href="#app-6"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/eqn.png)

If you have not loaded a prior model file or selected a model from the library, you can write the differential equations here. The model diagram will update as information in the equations becomes available.

Use `dX[i]` for change in compartment amounts, where i is the compartment number, e.g. dX\[1\] or dX\[2\]. Compartment amounts are referred to as `X[i]`, e.g. X\[1\] or X\[2\]. Use `BOLUS[j]` or `B[j]` for bolus input j and `RATEIV[k]` or `R[k]` for infusion k. The indices j and k correspond to the `INPUT` column in the data file, which is omitted and assumed to be 1 for all doses for the most common scenario of modeling one drug input. The duration of the infusion and total dose is defined in the data. The `DUR` column in the data determines whether a dose is treated as a BOLUS (DUR = 0) or RATEIV (DUR \> 0). Any variable declared in `PRI`, `COV`, or `SEC` may be used in your equations.

**Note:** If you change the equations of an algebraic model loaded from the library, you will receive a warning in the app that you are forcing use of ODE solvers, and your model list (and file) will no longer have the algebraic token. Beware also of changing the parameter names, as the algebraic models must use specifically named parameters. However, it is perfectly acceptable to add parameters or even change primary parameters as long as the original appear in the secondary block. For example, if you wish to make volume dependent on weight, change `V` in the Primary section to something like `V0` with appropriate range or mean/SD, and add `V = V0 * wt` to your Secondary section, assuming you have a covariate named "wt". Because `V` is still defined, Pmetrics will know how to solve the algebraic model. -->
</section><section class="level4" data-number="3.8.2"><h4 data-number="3.8.2" id="list-6">
<span class="header-section-number">3.8.2</span> List<a class="anchor" aria-label="anchor" href="#list-6"></a>
</h4>
<p>Specify a model as a function called “eqn”, with each element an ordinary differential equation in R syntax. Additional equations can be included.</p>
<p><strong>Note 1</strong>: Local variables defined within the <code>eqn</code> function are not available outside the function. If you wish to use a variable in other blocks, define it in the <code>sec</code> function.</p>
<p><strong>Note 2</strong>: If your data file has dose inputs with <code>DUR = 0</code>, these are considered to be instantaneous bolus inputs, and you must use <code>B[.]</code> or <code>BOLUS[.]</code> to represent them in the equations. If your data file has dose inputs with <code>DUR &gt; 0</code>, these are considered to be infusions, and you should use <code>R[.]</code> or <code>RATEIV[.]</code> to represent them in the equations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ka <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      Kcp <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      Kpc <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    eqn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">ktotal</span> <span class="op">=</span> <span class="va">Ke</span> <span class="op">+</span> <span class="va">Kcp</span> <span class="co"># local variable, not available outside eqn block</span></span>
<span>      <span class="va">dX</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">B</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">Ka</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">dX</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">R</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">Ka</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span><span class="va">ktotal</span><span class="op">)</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">Kpc</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>      <span class="va">dX</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="va">Kcp</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">Kpc</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>To specify models from the library, first ensure the correct library model name by using the <a href="https://lapkb.github.io/Pmetrics/reference/model_lib.html" class="external-link"><code>model_lib</code></a> function. Also, ensure that the variable names in the library are defined somewhere in the model (mostly in the <code>PRI</code> block), and similarly that <code>OUT</code> equations are correct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> PM_model<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">pri =</span> <span class="fu">list</span>( <span class="co"># parameter names match those listed in model_lib(), except V0</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ka =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Ke =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">V0 =</span> <span class="fu">msd</span>(<span class="dv">10</span>, <span class="dv">3</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">Kcp =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">Kpc =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cov =</span> <span class="fu">list</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt =</span> <span class="fu">interp</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec =</span> <span class="cf">function</span>(){</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        V <span class="ot">=</span> V0 <span class="sc">*</span> wt <span class="co"># here we define the last parameter, V, found in model_lib() for this model</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">eqn =</span> <span class="cf">function</span>(){</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"three_comp_bolus"</span> <span class="co"># name acquired from model_lib()</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">out =</span> <span class="cf">function</span>(){</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        Y[<span class="dv">1</span>] <span class="ot">=</span> X[<span class="dv">2</span>]<span class="sc">/</span>V <span class="co"># correct compartment (2) identified as the output</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">err =</span> <span class="fu">list</span>(</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">proportional</span>(<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</section><section class="level4" data-number="3.8.3"><h4 data-number="3.8.3" id="file-6">
<span class="header-section-number">3.8.3</span> File<a class="anchor" aria-label="anchor" href="#file-6"></a>
</h4>
<p>Use the same syntax as in the R function in a list specification.</p>
<p>Example:</p>
<div class="script">
<p>#EQN<br>
ktotal = Ke + KCP<br>
dX[1] = B[1] -KA*X[1]<br>
dX[2] = R[1] + KA*X[1] - (ktotal)*X[2] + KPC*X[3]<br>
dX[3] = KCP*X[2] - KPC*X[3]</p>
</div>
<p><strong><em>Note</em></strong>: Pmetrics no longer recognizes the old Fortran format of XP(1), which is dX[1], and X(1), which is X[1].</p>
</section></section><section class="level3" data-number="3.9"><h3 data-number="3.9" id="mb-out">
<span class="header-section-number">3.9</span> Outputs<a class="anchor" aria-label="anchor" href="#mb-out"></a>
</h3>
<p>The outputs in Pmetrics are the values in the <code>OUT</code> column of the data that you are trying to predict. In the model objects, each output is referred to as <code>Y[.]</code>, where “.” is the number of the output and the same as the corresponding <code>OUTEQ</code> in the data. Outputs can be defined as mathematical combinations of compartment amounts (<code>X[.]</code>), primary and/or secondary parameters, or covariates.</p>
<p>Output equations are in R format. If they include conditional statements, these should follow R’s <code>if(){}</code> convention.</p>
<section class="level4" data-number="3.9.1"><h4 data-number="3.9.1" id="app-7">
<span class="header-section-number">3.9.1</span> App<a class="anchor" aria-label="anchor" href="#app-7"></a>
</h4>
<p>Coming soon.</p>
<!-- ![](Images/model_builder/output.png)

On this tab, you can choose the number of output equations and define the equation for each output. You do not need to specify "Y\[.\] =" in the equations. Simply include the right side of the equation in the field.

Include the **Assay Error** polynomial coefficients for each output equation. The four coefficients estimate SD according to the folowing equation: $C0 + C1 * [obs] + C2 * [obs]^2 + C3 * [obs]^3$ and $[obs]$ is the observation. The values for the coefficients should ideally come from the analytic lab in the form of inter-run standard deviations or coefficients of variation at standard concentrations. You can use the Pmetrics function `makeErrorPoly()` to choose the best set of coefficients that fit the data from the laboratory. Alternatively, you can use a generic set of coefficients. We recommend that as a start, $C0$ be set to half of the lowest concentration in the dataset and $C1$ be set to 0.1. $C2$ and $C3$ can be 0.

If you check the *Use Always?* box, the model coefficients will be used regardless of what is in the data file. Leaving it unchecked, which is the default, means that coefficients in the data file will be used if present, and the ones here in the model definition will be used only if none are available for an observation in the data.

Choose your **Model Error** model from the drop down. The additive $\lambda$ and proportional $\gamma$ models both have fixed options. If not fixed, the parameter will be estimated, starting from the number in the *Value* field. If fixed, it will be held constant at the number in the *Value* field.

The proportional model weights each observation by $1/(\gamma * SD)^2$, where $\gamma$ is either fixed or estimated. The additive model weights each observation by $1/(\lambda + SD)^2$, where $\lambda$ is either fixed or estimated. The combination model uses $1/((\gamma * SD)^2 + (\lambda + SD)^2)$.

In the proportional model, $\gamma$ is a scalar on assay SD. In general, well-designed and executed studies and models with low mis-specification will have data with $\gamma$ values approaching 1. Values \<1 suggest over-inflated assay noise. Poor quality, noisy data will result in $\gamma$ of 5 or more. A good starting value for $\gamma$ is usually 5, and sometimes 10 early in model development if data are particularly complex or noisy.

In the additive model, $\lambda$ is additive to assay SD. In general, well-designed and executed studies and models with low mis-specification will have data with $\lambda$ values approaching 0. Values of 0 may suggest over inflated assay noise. Poor quality, noisy data will result in $\lambda$ of $5*C0$ or more. A good starting value for $\lambda$ is usually $3*C0$. Note, that $C0$ should generally not be 0, as it represents machine noise (e.g. HPLC or mass spectrometer) that is always present. -->
</section><section class="level4" data-number="3.9.2"><h4 data-number="3.9.2" id="list-7">
<span class="header-section-number">3.9.2</span> List<a class="anchor" aria-label="anchor" href="#list-7"></a>
</h4>
<p>The <code>out</code> element of the model list is function. Any R code is valid within the function. Secondary variables declared here will only be available within the function. The output equations are of the form “Y[.] = expression”, where “.” is the output equation number in the data. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in R code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">V</span></span>
<span><span class="op">}</span></span>
<span>  </span></code></pre></div>
</div>
</section><section class="level4" data-number="3.9.3"><h4 data-number="3.9.3" id="file-7">
<span class="header-section-number">3.9.3</span> File<a class="anchor" aria-label="anchor" href="#file-7"></a>
</h4>
<p>Outputs are of the form Y[.] = expression, where “.” is the output equation number. Primary and secondary variables and covariates may be used in the expression, as can conditional statements in Fortran code. An “&amp;” continuation prefix is not necessary in this block for any statement, although if present, will be ignored. <strong>There can be a maximum of 6 outputs.</strong> They are referred to as Y[1], Y[2], etc. These equations may also define a model explicitly as a function of primary and secondary variables and covariates.</p>
<p>Examples:</p>
<div class="script">
<p>#Out<br>
Y[1] = X[2]/V</p>
</div>
<p>Here’s an example of an explicit model defined in the output and not the equation block.</p>
<div class="script">
<p>#OUT<br></p>
<p>RES = BOLUS[1] * KIN/(KIN-KOUT) * (EXP(-KOUT*TPD)-EXP(-KIN*TPD))<br>
Y[1] = RES/VD</p>
</div>
</section></section><section class="level3" data-number="3.10"><h3 data-number="3.10" id="mb-err">
<span class="header-section-number">3.10</span> Error<a class="anchor" aria-label="anchor" href="#mb-err"></a>
</h3>
<p>All models predict observations with error. Part of this error is due to measurement or assay error. The assay error in Pmetrics is explicitly accounted for, and it may be inflated by an additive model error component <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> or a proportional component <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> that reflect additional noise and model misspecification. The remaining error is random and not optimized.</p>
<p>When fitting, the error in a prediction determines how closely the model must match the observation. Pmetrics weights predictions by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1/error^2</annotation></semantics></math>. The standard deviation of an prediction is calculated from the assay error model as <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><msub><mi>D</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>C</mi><mn>0</mn><mo>+</mo><mi>C</mi><mn>1</mn><mo>*</mo><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi><mo>+</mo><mi>C</mi><mn>2</mn><mo>*</mo><mi>p</mi><mi>r</mi><mi>e</mi><msup><mi>d</mi><mn>2</mn></msup><mo>+</mo><mi>C</mi><mn>3</mn><mo>*</mo><mi>p</mi><mi>r</mi><mi>e</mi><msup><mi>d</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">SD_{pred} = C0 + C1*pred + C2*pred^2 + C3*pred^3</annotation></semantics></math>. Error is then calculated according to the selected model error structure:</p>
<ul>
<li>
<strong>Proportional</strong>: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>γ</mi><mo>*</mo><mi>S</mi><msub><mi>D</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">error = \gamma * SD_{pred}</annotation></semantics></math>
</li>
<li>
<strong>Additive</strong>: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>r</mi><mo>=</mo><mi>λ</mi><mo>+</mo><mi>S</mi><msub><mi>D</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">error = \lambda + SD_{pred}</annotation></semantics></math>
</li>
</ul>
<p><strong>Note:</strong> Each output equation must have an error model. In Pmetrics versions prior to 3.0.0, each output equation had its own assay error polynomial, but there was only one model error for all outputs. In Pmetrics ≥ 3.0.0, each output equation has its own assay error polynomial and its own model error, allowing for greater flexibility in modeling complex data.</p>
<section class="level4" data-number="3.10.1"><h4 data-number="3.10.1" id="app-8">
<span class="header-section-number">3.10.1</span> App<a class="anchor" aria-label="anchor" href="#app-8"></a>
</h4>
<p>Coming soon.</p>
</section><section class="level4" data-number="3.10.2"><h4 data-number="3.10.2" id="list-8">
<span class="header-section-number">3.10.2</span> List<a class="anchor" aria-label="anchor" href="#list-8"></a>
</h4>
<p>The error list element is a list of creator functions. The two possible creator functions are <code>proportional</code> or <code>additive</code>. Each of these functions has the same arguments: <code>initial</code>, <code>coeff</code>, and <code>fixed</code>.</p>
<ul>
<li>The <code>initial</code> argument is the starting value for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> in the <code><a href="../reference/proportional.html">proportional()</a></code> creator function or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> for the <code><a href="../reference/additive.html">additive()</a></code> creator function.</li>
<li>For both creators, <code>coeff</code> is the vector of 4 numbers that defines a polynomial equation to permit calculation of the standard deviation of an observation, based on the noise of the assay (see <a href="https://lapkb.github.io/Pmetrics/reference/makeErrorPoly.html" class="external-link"><code>makeErrorPoly</code></a>).</li>
<li>The final argument <code>fixed</code> is <code>FALSE</code> by default, which means that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> will be estimated for each output equation as measures of additional noise in the data and/or model misspecification. If <code>fixed</code> is set to <code>TRUE</code>, then the value in <code>initial</code> will be held constant during estimation.</li>
</ul>
<p>In the code snippet below, there are two output equations so there are two error models. The first is a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> proportional model with starting value 1, which will be updated based on the model fit of the data, and assay polynomial coefficients of 0.15, 0.1, 0, and 0. The second is an additive <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> model with starting value 0.1, assay polynomial coefficients of 0.1, 0, 0, and 0, and because <code>fixed = TRUE</code>, it will not be estimated and will be held constant at 0.1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  out <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">V1</span></span>
<span>    <span class="va">Y</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">V2</span></span>
<span>  <span class="op">}</span>,</span>
<span>  err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/proportional.html">proportional</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/additive.html">additive</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>More complete examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  eqn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">one_comp_iv</span></span>
<span>  <span class="op">}</span>,</span>
<span>  out <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">V</span></span>
<span>  <span class="op">}</span>,</span>
<span>  err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/proportional.html">proportional</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>      </span>
<span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    kin <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    kout <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    tpd <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    V <span class="op">=</span> <span class="fu"><a href="../reference/msd.html">msd</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sec <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">=</span> <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">kin</span><span class="op">/</span><span class="op">(</span><span class="va">kin</span><span class="op">-</span><span class="va">kout</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">kout</span><span class="op">*</span><span class="va">tpd</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">kin</span><span class="op">*</span><span class="va">tpd</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  out <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">res</span><span class="op">/</span><span class="va">v</span></span>
<span>  <span class="op">}</span>,</span>
<span>  err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/additive.html">additive</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.15</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>This last example is known as the Bateman equation for a model with linear absorption (KIN) into and elimination (KOUT) from a central compartment, and a time post-dose (TPD) or lag time. Here B[1] is the oral bolus dosing vector for drug 1, and V is the volume of the central compartment.</p>
</section><section class="level4" data-number="3.10.3"><h4 data-number="3.10.3" id="file-8">
<span class="header-section-number">3.10.3</span> File<a class="anchor" aria-label="anchor" href="#file-8"></a>
</h4>
<p>Unlike the R6 model builder app or model list, the error block in the file is separated from the output block. This is to maintain backward compatibility with Legacy Pmetrics.</p>
<p>To specify the model in this block, the first line is either L=number or G=number for a <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> error model. The number is the starting value for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>. If you include an exclamation point (!) in the declaration, then <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> will be fixed and not estimated. Recall that you can only fix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> currently to zero.</p>
<p>The next line(s) contain the values for the assay error polynomial coefficients: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">C0</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">C1</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">C2</annotation></semantics></math>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">C3</annotation></semantics></math>, separated by commas. There should be one line of coefficients for each output equation. By default Pmetrics will use values for these coefficients found in the data file. If none are present or if the model declaration line contains an exclamation point (!) the values here will be used.</p>
<p>Example 1: estimated <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>, starting at 0.4, one output, use data file coefficients but if missing, use 0.1,0.1,0,0.</p>
<div class="script">
<p>#Err<br>
L=0.4<br>
0.1,0.1,0,0<br></p>
</div>
<p>Example 2: fixed <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math> of 2, two outputs, use data file coefficients but if missing, use 0.1,0.1,0,0 for the first output, but use 0.3, 0.1, 0, 0 for output 2 regardless of what is in the data file.</p>
<div class="script">
<p>#Err<br>
G=2!<br>
0.1,0.1,0,0<br>
0.3,0.1,0,0!<br></p>
</div>
<!-- ### Extra {#extra}

#### App, List

This block is not currently implemented in either the app or list forms.

#### File

This block will be for advanced Rust programmers only who wish to include additional code in the model. It is not yet implemented. -->
</section></section><section class="level3" data-number="3.11"><h3 data-number="3.11" id="completeEx">
<span class="header-section-number">3.11</span> Complete File Example<a class="anchor" aria-label="anchor" href="#completeEx"></a>
</h3>
<p>Here is a complete example of a model file, as of Pmetrics version 3.0 and higher:</p>
<div class="script">
<p>#Pri<br>
KE, 0, 5<br>
V0, 0.1, 100<br>
KA, 0, 5<br>
Lag1, 0, 3<br></p>
<p>#Cov<br>
wt<br>
C this weight is in kg<br></p>
<p>#Sec<br>
V = V0*wt<br></p>
<p>#Lag<br>
LAG[1] = Tlag1</p>
<p>#Eqn<br>
two_comp_bolus<br></p>
<p>#Out<br>
Y[1] = X[2]/V<br></p>
<p>#Err<br>
L=0.4<br>
0.1, 0.1, 0, 0<br></p>
</div>
<p><em>Notes</em>:</p>
<p>The value of “two_comp_bolus” in the #Eqn block tells Pmetrics to use the algebraic solution for the model. The #Pri block contains the primary parameters and their initial ranges, which are the only parameters that will be estimated. The #Cov block contains the covariate names. The #Sec block contains the global secondary equations used to incorporate the covariate “wt” in the model definition. The #Lag block contains the lag time for the bolus input. The #Out block contains the output equation. The relevant compartment number that contains the amount of drug, 2, is obtained by looking at <code><a href="../reference/model_lib.html">model_lib()</a></code> to see which compartment is the central, so that it can be divided by <code>V</code> to obtain concentration. The #Err block contains the model error structure (lambda, additive) with a starting value of 0.4, and assay error coefficients of 0.1, 0.1, 0, and 0.</p>
<!-- If you build the same algebraic model in the app by selecting it from the library, and save the file, Pmetrics will write the #EQN blocks for you. -->
<p>The comment line “C this weight is in kg” will be ignored.</p>
<!-- ## Saving and copying models from the app

![](Images/model_builder/output2.png)

The Model List tab in the bottom window of the app shows the List form of the model. You can see it develop as you complete components. Once the model is finished, you can use one or both of the buttons at the bottom to copy or save the model.

Choosing *Copy* will put the code in you clipboard and you can paste it into R. It will include `PM_model$new(...)`, so you should add code such as `mod1 <-` to your R script, and then paste. This will entirely define `mod1` as a `PM_model` equivalent to what you built in the app.

Choosing *Save* in the app will write a file named "model.txt" to your current working directory in R that contains all the code necessary to define the same model as you build in the app. Be aware that if there is another file named "model.txt" in your working directory, it will be overwritten.

While incomplete models can be copied, a model can only be saved when it is complete. It is necessary for you to at least open relevant components to ensure that all fields are finalized in the Model List before you can save it. -->
</section></section><section class="level2" data-number="4"><h2 data-number="4" id="update-model">
<span class="header-section-number">4</span> Updating models<a class="anchor" aria-label="anchor" href="#update-model"></a>
</h2>
<!-- ### App

You can update an existing model in one of two ways in the app:

-   Pass the `PM_model` object to the app as an argument to `build_model()`, for example, `build_model(NPex$model)`. Then, edit the appropriate fields in the app. Save the model as a new model and/or copy it into R. Note that the app saves all models as "model.txt" so be sure not to overwrite your old model if you wish to keep it.
-   Load a previously saved model file using the dialog button in the app and proceed as for the first option above. -->
<section class="level3" data-number="4.1"><h3 data-number="4.1" id="list-9">
<span class="header-section-number">4.1</span> List<a class="anchor" aria-label="anchor" href="#list-9"></a>
</h3>
<p>Because models are loaded as memory items in R6 Pmetrics, they can be modified in R without having to edit text files. This function is accessed via the <code>$update()</code> method for <code>PM_model</code> objects.</p>
<p>All R6 objects are mini-environments, so direct copies of an R6 environment are in the same environment and changes to one will change them all. This means the following code will likely not work as intended.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod1</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<p>When <em>mod2</em> is updated, <em>mod1</em> will update as they are in the same environment. The way to create an independent copy of an R6 object, which does not share the same environment, is to use the <code>$clone()</code> method available for all R6 objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now changes to mod2 do not propagate to mod1.</p>
<p>To update a model, simply supply the list items you wish to change with the new values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span></span>
<span>   pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    Ke <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    V <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    V0 <span class="op">=</span> <span class="fu"><a href="../reference/ab.html">ab</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>   <span class="op">)</span>,</span>
<span>  sec <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">V</span> <span class="op">=</span> <span class="va">V0</span> <span class="op">*</span> <span class="va">wt</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>This example changes the range of <em>Ke</em>, deletes <em>V</em>, adds <em>V0</em>, and defines a new secondary relationship for <em>V = V0 * wt</em>.</p>
</section><section class="level3" data-number="4.2"><h3 data-number="4.2" id="file-9">
<span class="header-section-number">4.2</span> File<a class="anchor" aria-label="anchor" href="#file-9"></a>
</h3>
<p>The only way to update a model file is to edit the text file and load it with <code>PM_model$new()</code>. The advantage is that it is quick and relatively easy. The disadvantage is that you have to keep editing, copying and pasting files, and unless your documentation in R or elsewhere is good, you have no idea how you changed the model from run to run. In contrast, by using the <code>$update()</code> method in R6, you can see a written record of how the model evolved over the project.</p>
</section></section><section class="level2" data-number="5"><h2 data-number="5" id="reserved">
<span class="header-section-number">5</span> Reserved Names<a class="anchor" aria-label="anchor" href="#reserved"></a>
</h2>
<p>The following cannot be used as primary, covariate, or secondary variable names. They can be used in equations, however.</p>
<div class="cell">
<div class="cell-output-display">
<div id="dqlwxrldph" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dqlwxrldph table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dqlwxrldph thead, #dqlwxrldph tbody, #dqlwxrldph tfoot, #dqlwxrldph tr, #dqlwxrldph td, #dqlwxrldph th {
  border-style: none;
}

#dqlwxrldph p {
  margin: 0;
  padding: 0;
}

#dqlwxrldph .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dqlwxrldph .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dqlwxrldph .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dqlwxrldph .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dqlwxrldph .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dqlwxrldph .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dqlwxrldph .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dqlwxrldph .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dqlwxrldph .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dqlwxrldph .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dqlwxrldph .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dqlwxrldph .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dqlwxrldph .gt_spanner_row {
  border-bottom-style: hidden;
}

#dqlwxrldph .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dqlwxrldph .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dqlwxrldph .gt_from_md > :first-child {
  margin-top: 0;
}

#dqlwxrldph .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dqlwxrldph .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dqlwxrldph .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dqlwxrldph .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dqlwxrldph .gt_row_group_first td {
  border-top-width: 2px;
}

#dqlwxrldph .gt_row_group_first th {
  border-top-width: 2px;
}

#dqlwxrldph .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dqlwxrldph .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dqlwxrldph .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dqlwxrldph .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dqlwxrldph .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dqlwxrldph .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dqlwxrldph .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dqlwxrldph .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dqlwxrldph .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dqlwxrldph .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dqlwxrldph .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dqlwxrldph .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dqlwxrldph .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dqlwxrldph .gt_left {
  text-align: left;
}

#dqlwxrldph .gt_center {
  text-align: center;
}

#dqlwxrldph .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dqlwxrldph .gt_font_normal {
  font-weight: normal;
}

#dqlwxrldph .gt_font_bold {
  font-weight: bold;
}

#dqlwxrldph .gt_font_italic {
  font-style: italic;
}

#dqlwxrldph .gt_super {
  font-size: 65%;
}

#dqlwxrldph .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dqlwxrldph .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dqlwxrldph .gt_indent_1 {
  text-indent: 5px;
}

#dqlwxrldph .gt_indent_2 {
  text-indent: 10px;
}

#dqlwxrldph .gt_indent_3 {
  text-indent: 15px;
}

#dqlwxrldph .gt_indent_4 {
  text-indent: 20px;
}

#dqlwxrldph .gt_indent_5 {
  text-indent: 25px;
}

#dqlwxrldph .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dqlwxrldph div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table caption-top" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings header">
<th id="Reserved.Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="background-color: #000000; color: #FFFFFF; font-weight: bold" scope="col">Reserved.Variable</th>
<th id="Function.in.Pmetrics" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="background-color: #000000; color: #FFFFFF; font-weight: bold" scope="col">Function.in.Pmetrics</th>
</tr></thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Reserved.Variable">t</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">time</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Reserved.Variable">x</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">array of compartment amounts</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Reserved.Variable">dx</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">array of first derivative of compartment amounts</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Reserved.Variable">p</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">array of primary parameters</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Reserved.Variable">rateiv / r</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">infusion vector</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Reserved.Variable">bolus / b</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">bolus vector</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Reserved.Variable">cov</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">covariate hashmap</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Reserved.Variable">y</td>
<td class="gt_row gt_left" headers="Function.in.Pmetrics">output vector</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Neely, Julián Otálvaro, Markus Hößvd.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
