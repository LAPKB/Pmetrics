<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation • Pmetrics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="simulation_files/libs/quarto-html/popper.min.js"></script><script src="simulation_files/libs/quarto-html/tippy.umd.min.js"></script><link href="simulation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="simulation_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link rel="stylesheet" href="Styles/style.css">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Simulation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/pmetrics.html">Start Here</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/data.html">Data Objects</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Model Objects</a></li>
    <li><a class="dropdown-item" href="../articles/running.html">Running the fit</a></li>
    <li><a class="dropdown-item" href="../articles/objects.html">Created Objects</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/pta.html">Probability of Target Attainment</a></li>
    <li><a class="dropdown-item" href="../articles/plotly.html">Plotly plots</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LAPKB/Pmetrics_rust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation</h1>




      <small class="dont-index">Source: <a href="https://github.com/LAPKB/Pmetrics_rust/blob/main/vignettes/simulation.qmd" class="external-link"><code>vignettes/simulation.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2" data-number="1"><h2 data-number="1" id="introduction-to-simulations">
<span class="header-section-number">1</span> Introduction to simulations<a class="anchor" aria-label="anchor" href="#introduction-to-simulations"></a>
</h2>
<p>The Pmetrics simulator is a powerful Monte Carlo engine that is smoothly integrated with Pmetrics inputs and outputs.</p>
<p>The simulator needs <strong>3 mandatory inputs</strong>:</p>
<ol type="1">
<li>
<em>Data</em>, which serves as the template providing inputs (e.g. doses) and outputs (e.g. concentrations)</li>
<li>
<em>Model</em>, which provides the equations</li>
<li>
<em>Joint probability value distributions for the parameters in the model</em>, i.e., the prior distribution from which to sample parameter values</li>
</ol>
<p>There are <strong>two ways to call the simulator</strong>, which we discuss in more detail below.</p>
<ol type="1">
<li>Use the <code>$sim()</code> method with a <a href="https://lapkb.github.io/Pmetrics/reference/PM_result.html" class="external-link"><code>PM_result</code></a> object, e.g. <code>run1 &lt;- PM_load(1); sim1 &lt;- run1$sim(...)</code>
</li>
<li>Use <a href="https://lapkb.github.io/Pmetrics/reference/PM_sim.html" class="external-link"><code>PM_sim</code></a> directly, e.g. <code>sim2 &lt;- PM_sim$new(...)</code>
</li>
</ol>
<p>Whether you use <code>PM_result$sim()</code> or <code>PM_sim$new()</code>, unlike the prior versions of Pmetrics, you do not need to read the simulator output files with <code>SIMparse</code>; Pmetrics does that for you automatically and returns the <code>PM_sim</code> object.</p>
</section><section class="level2" data-number="2"><h2 data-number="2" id="simulator-input-details">
<span class="header-section-number">2</span> Simulator input details<a class="anchor" aria-label="anchor" href="#simulator-input-details"></a>
</h2>
<section class="level3" data-number="2.1"><h3 data-number="2.1" id="data">
<span class="header-section-number">2.1</span> Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>The data template for a simulation is a <a href="https://lapkb.github.io/Pmetrics/reference/PM_data.html" class="external-link"><code>PM_data</code></a> object, with exactly the same structure as used for fitting models. This template contains the dosing and observation history as well as any covariates for each subject to be simulated. Each subject in the data template will serve as a template for <code>nsim</code> simulated profiles. You can supply the <code>PM_data</code> object in a number of ways.</p>
<ul>
<li>Use a previously created <code>PM_data</code> object, usually from an appropriate file with <code>PM_data$new("filename")</code> but could be created with the <code>$addEvent()</code> method (see <a href="data.html">data</a> for details) or by creating an appropriate data frame in R and passing it to <code>PM_data$new()</code>.</li>
<li>Provide the name of an appropriate data file with path if needed. Use <a href="https://rdrr.io/pkg/base/man/getwd.html" class="external-link"><code>getwd</code></a> and <a href="https://rdrr.io/pkg/base/man/list.files.html" class="external-link"><code>list.files</code></a> to ensure the path and filename are correct.</li>
<li>If using <code>PM_result$sim()</code>, omit the <code>data</code> argument to use the data in the <code>PM_result</code> as the template.</li>
</ul>
<p>When simulating, observation values (the <code>OUT</code> column) for <code>EVID=0</code> events in the template can take any value, which will be replaced with the simulated values. This includes observations coded as missing, <code>OUT = -99</code>, or censored, <code>CENS = 1</code> or <code>CENS = -1</code>. Such scenarios are only expected if using the data from a <code>PM_result</code>,method 1 above to call the simulator. When making a new template, a good choice is <code>OUT = -1</code> to remind you that it is being simulated, but this value is optional.</p>
<p>You can have any number of subject records within a data template, each with its own doses, dose times, observation times, and covariate values if applicable. Each subject will generate as many simulated profiles as you specify. You can control which subjects in the template are used and how many are simulated with the <code>include</code>, <code>exclude</code>, and <code>nsim</code> arguments to the simulator (see below). The first two arguments specify which subjects in the data object will serve as templates for simulation. The second specifies how many profiles are to be generated from each included subject.</p>
</section><section class="level3" data-number="2.2"><h3 data-number="2.2" id="model">
<span class="header-section-number">2.2</span> Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h3>
<p>Analogous to the data template, the model for a simulation is a <a href="https://lapkb.github.io/Pmetrics/reference/PM_model.html" class="external-link"><code>PM_model</code></a> object, with exactly the same structure as used for fitting. You can supply the <code>PM_model</code> object in a number of ways.</p>
<ul>
<li>Use a previously created <code>PM_model</code> object, either from an appropriate file with <code>PM_model$new("filename")</code> but also by defining a model list directly in R (see <a href="models.html">models</a> for details) passing it to <code>PM_model$new()</code>.</li>
<li>Provide the name of an appropriate model file with path if needed. Use <a href="https://rdrr.io/pkg/base/man/getwd.html" class="external-link"><code>getwd</code></a> and <a href="https://rdrr.io/pkg/base/man/list.files.html" class="external-link"><code>list.files</code></a> to ensure the path and filename are correct.</li>
<li>If using <code>PM_result$sim()</code>, omit the <code>model</code> argument to use the model in the <code>PM_result</code> as the template.</li>
</ul>
<p>The model primary (random) parameters must match the parameters in the <code>poppar</code> argument (see below). Any covariates in model equations must be included in the data template.</p>
</section><section class="level3" data-number="2.3"><h3 data-number="2.3" id="population-parameter-distribution">
<span class="header-section-number">2.3</span> Population parameter distribution<a class="anchor" aria-label="anchor" href="#population-parameter-distribution"></a>
</h3>
<p>The other mandatory item is a prior probability distribution for all random parameter values in the model. Pmetrics draws samples from this distribution to create the simulated output. You can supply the <code>poppar</code> prior object with the population parameters in a number of ways.</p>
<ul>
<li>Use a previously created <a href="https://lapkb.github.io/Pmetrics/reference/PM_final.html" class="external-link"><code>PM_final</code></a> object which is a field in a <code>PM_result</code> object, e.g. <code>run1 &lt;- PM_load(1); poppar &lt;- run1$final</code>.</li>
<li>If using <code>PM_result$sim()</code>, omit the <code>poppar</code> argument to use the <code>PM_final</code> object in the <code>PM_result</code>.</li>
<li>Create a <code>poppar</code> list directly in R, which is detailed below.</li>
</ul>
<section class="level4" data-number="2.3.1"><h4 data-number="2.3.1" id="details-on-manually-specifying-poppar">
<span class="header-section-number">2.3.1</span> Details on manually specifying <code>poppar</code>
<a class="anchor" aria-label="anchor" href="#details-on-manually-specifying-poppar"></a>
</h4>
<p>This is a flexible but somewhat complex means of creating a prior without a previous Pmetrics fit. It is suitable for lifting priors from published models or other sources. A manually specified prior as a list containing the following named items:</p>
<ul>
<li>
<strong>wt</strong> vector of weights (probabilities) of sampling from each distribution. If missing, assumed to be 1. If only one distribution is to be specified the<code>wt</code> vector can be omitted or should be <code>wt = 1</code>. If multiple distributions are to be sampled, the <code>wt</code> vector should be of length equal to the number of distributions in <code>mean</code> and the values of <code>wt</code> should sum to 1, e.g. <code>wt = c(0.25, 0.05, 0.7)</code>.</li>
<li>
<strong>mean</strong> a list of mean parameter values. Each element of the list should be named with the parameter name and be a vector of length equal to the number of distributions.</li>
<li>
<strong>sd</strong> an optional named list of overall standard deviations for each parameter, considering parameters as unimodally distributed, i.e. there should only be one value for each parameter, regardless of the number of distributions. <code>sd</code> is only needed if a correlation matrix is specified, which will be converted to a covariance matrix.</li>
<li>
<strong>ONE</strong> of the following matrices:
<ol type="1">
<li>
<strong>cor</strong> A square matrix of the overall correlations between parameters, again considered as unimodally distributed, i.e. there should only be one correlation matrix regardless of the number of distributions. If a correlation matrix is specified, the <code>sd</code> element is required to calculate the covariance matrix.</li>
<li>
<strong>cov</strong> A square matrix of the overall covariances between parameters, again considered as unimodally distributed, i.e. there should only be one covariance matrix regardless of the number of distributions. If a covariance matrix is specified, the <code>sd</code> element is unnecessary, since the diagonals of the covariance matrix are the variances or squared standard deviations. The covariance matrix, whether specified as <code>cov</code> or as a combination of <code>cor</code> and <code>sd</code>, will be divided by the number of distributions, i.e. <code>length(wt)</code>, and applied to each distribution.</li>
</ol>
</li>
</ul>
<p><strong>Examples</strong> of manually specifying <code>poppar</code>:</p>
<ul>
<li>
<p>Single distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">poppar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="fl">1</span>, </span>
<span>            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ke <span class="op">=</span> <span class="fl">0.5</span>, v <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, </span>
<span>            cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.04</span>, <span class="fl">2.4</span>, <span class="fl">2.8</span>, <span class="fl">400</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
</div>
</li>
</ul>
<p><strong>Notes:</strong> Here, <code>sd</code> is not required because <code>cov</code> was specified.</p>
<ul>
<li>
<p>Multiple distributions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">poppar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.15</span>, <span class="fl">0.75</span><span class="op">)</span>, <span class="co"># 3 distributions that sum to 1</span></span>
<span>            mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ke <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>, v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>, <span class="co"># 3 values for each parameter</span></span>
<span>            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ke <span class="op">=</span> <span class="fl">0.2</span>, v <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="co"># overall sd, ignoring multiple distributions</span></span>
<span>            cor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">1</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span>
<span>            <span class="co"># sd required because cor specified</span></span></code></pre></div>
</div>
</li>
</ul>
<p><strong>Notes:</strong></p>
</section></section></section><section class="level2" data-number="3"><h2 data-number="3" id="details-on-running-the-simulator">
<span class="header-section-number">3</span> Details on running the simulator<a class="anchor" aria-label="anchor" href="#details-on-running-the-simulator"></a>
</h2>
<p>You run the simulator in two ways.</p>
<ul>
<li>Use the <code>$sim()</code> method for <code><a href="../reference/PM_result.html">PM_result()</a></code> objects. This takes <code>poppar</code> from the <code>PM_result$final</code> field and the model from the <code>PM_result$model</code> field, so only a data object needs to be specified at minimum. If no data object is specified, it will use the <code>PM_result$data</code> as a template, i.e. the same data used to fit the model. An example is below. You don’t have to supply the model or <code>poppar</code>, because they are included in <code>run1</code>, with <code>poppar</code> taken from the <code>run$final</code> field. Supplying a different <code>PM_data</code> object as <code>dat</code> allows you to use the model and population prior from <code>run1</code> with a different dosing and observation data template. If you omit <code>dat</code> in this example, the original data in <code>run1</code> would serve as the template.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PM_load.html">PM_load</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="va">run1</span><span class="op">$</span><span class="fu">sim</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, nsim <span class="op">=</span> <span class="fl">100</span>, limits <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
</div>
<ul>
<li>Use <code>PM_sim$new()</code>. This simulates without necessarily having completed a fitting run previously, i.e., there may be no <code><a href="../reference/PM_result.html">PM_result()</a></code> object. Here, you manually specify values for <code>poppar</code>, <code>model</code>, and <code>data</code>. These can be other Pmetrics objects, or de novo, which can be useful for simulating from models reported in the literature. An example is below.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim2</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_sim.html">PM_sim</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>poppar <span class="op">=</span> <span class="va">run2</span><span class="op">$</span><span class="va">final</span>, data <span class="op">=</span> <span class="va">dat</span>, model <span class="op">=</span> <span class="va">mod1</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now you must include all three of the mandatory arguments: <code>model</code>, <code>data</code>, and <code>poppar</code>. In this case we used the <code><a href="../reference/PM_final.html">PM_final()</a></code> object from a different run (<code>run2</code>) as the <code>poppar</code>, but we could also specify <code>poppar</code> as a list, for example. See <code>SIMrun()</code> for details on constructing a manual <code>poppar</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poppar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wt <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">100</span><span class="op">)</span>, covar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">900</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Under the hood, both of these calls to the simulator use the <span class="legacy">Legacy</span> <code>SIMrun()</code> function, and thus all its arguments are available when using <code>PM_result$sim(...)</code> or <code>PM_sim$new(...)</code>.</p>
</section><section class="level2" data-number="4"><h2 data-number="4" id="simulation-options">
<span class="header-section-number">4</span> Simulation options<a class="anchor" aria-label="anchor" href="#simulation-options"></a>
</h2>
<p>Details of all arguments available to modify simulations are available by typing <code>?SIMrun</code> into the R console or reading the documentation for <code>SIMrun()</code>. A few are highlighted here.</p>
<p>Simulation from a non-parametric prior distribution (from NPAG) can be done in one of two ways. The first is simply to take the mean and covariance matrix of the distribution and perform a standard Monte Carlo simulation. This is accomplished by setting <code>split = FALSE</code> as an argument.</p>
<p>The second way is what we call semi-parametric <span class="citation" data-cites="goutelle_nonparametric_2022">(<a href="#ref-goutelle_nonparametric_2022" role="doc-biblioref">Goutelle et al. 2022</a>)</span>. In this method, the non-parametric “support points” in the population model, each a vector of one value for each parameter in the model and the associated probability of that set of parameter values, serve as the mean of one multi-variate normal distribution in a multi-modal, multi-variate joint distribution. The weight of each multi-variate distribution is equal to the probability of the point. The overall population covariance matrix is divided by the number of support points and applied to each distribution for sampling.</p>
<p>Below are illustrations of simulations with a single mean and covariance for two parameters (left, <code>split = FALSE</code>), and with multi-modal sampling (right, <code>split = TRUE</code>).</p>
<p><img src="Images/unibv40.png"><img src="Images/multi-bv40.png"></p>
<p>Limits may be specified for truncated parameter ranges to avoid extreme or inappropriately negative values. The simulator will report values for the total number of simulated profiles needed to generate <code>nsim</code> profiles within the specified limits, as well as the means and standard deviations of the simulated parameters to check for simulator accuracy.</p>
<p>Output from the simulator can be controlled by further arguments passed to <code>SIMrun()</code>. If <code>makecsv</code> is supplied, a .csv file with the simulated profiles will be created with the name as specified by <code>makecsv</code>; otherwise, there will be no .csv file created. If <code>outname</code> is supplied, the simulated values and parameters will be saved in a .txt file whose name is that specified by <code>outname</code>; otherwise the filename will be “simout”. In either case, integers 1 to the number of subjects will be appended to outname or “simout”, e.g. “simout1.txt”, “simout2.txt”.</p>
</section><section class="level2" data-number="5"><h2 data-number="5" id="simulation-output">
<span class="header-section-number">5</span> Simulation output<a class="anchor" aria-label="anchor" href="#simulation-output"></a>
</h2>
<p>In <span class="r6">R6</span>, simulation output files (e.g. <em>simout1.txt</em>, <em>simout2.txt</em>) are automatically read by <code>SIMparse()</code> and returned as the new <code><a href="../reference/PM_sim.html">PM_sim()</a></code> object that was assigned to contain the results of the simulation. All files will remain on the hard drive. You no longer need to use <code>SIMparse()</code> as Pmetrics will do it for you. This is unlike the <span class="legacy">Legacy</span> requirement for you to specifically read the output files from the simulator with <code>SIMparse()</code>.</p>
<p>If you simulated from a template with multiple subjects, you will have a simulation output from each template, and each will have <code>nsim</code> profiles. If you wish to combine all the simulations into one <code><a href="../reference/PM_sim.html">PM_sim()</a></code> object, use the argument <code>combine</code> in your call to the simulator run methods. It will be passed to <code>SIMparse()</code> during the post-simulation processing.</p>
<p>So if our data template has 3 subjects…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="va">run1</span><span class="op">$</span><span class="fu">sim</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span> <span class="co"># sim1 is a PM_sim with 3 simulation results</span></span>
<span><span class="va">sim2</span> <span class="op">&lt;-</span> <span class="va">run1</span><span class="op">$</span><span class="fu">sim</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, combine <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># sim2 is a PM_sim with combined results</span></span></code></pre></div>
</div>
<p><code><a href="../reference/PM_sim.html">PM_sim()</a></code> objects have 6 data fields and 6 methods.</p>
<section class="level3" data-number="5.1"><h3 data-number="5.1" id="data-fields">
<span class="header-section-number">5.1</span> Data fields<a class="anchor" aria-label="anchor" href="#data-fields"></a>
</h3>
<p>Data fields are accessed with <code>$</code>, e.g. <code>sim1$obs</code>.</p>
<ul>
<li>
<strong>amt</strong> A data frame with the amount of drug in each compartment for each template subject at each time.</li>
<li>
<strong>obs</strong> A data frame with the simulated observations for each subject, time and output equation.</li>
<li>
<strong>parValues</strong> A data frame with the simulated parameter values for each subject.</li>
<li>
<strong>totalCov</strong> The covariance matrix of all simulated parameter values, including those that were discarded to be within any <code>limits</code> specified.</li>
<li>
<strong>totalMeans</strong> The means of all simulated parameter values, including those that were discarded to be within any <code>limits</code> specified.</li>
<li>
<strong>totalSets</strong> The number of simulated sets of parameter values, including those that were discarded to be within any <code>limits</code> specified. This number will always be ≥ <code>nsim</code>.</li>
</ul>
<p>All of these are detailed further in <code>SIMparse()</code>.</p>
</section><section class="level3" data-number="5.2"><h3 data-number="5.2" id="methods">
<span class="header-section-number">5.2</span> Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<p>Methods are accessed with <code>$</code> and include parentheses to indicate a function, possibly with arguments e.g. <code>sim1$auc()</code> or <code>sim1$save("sim1.rds")</code>.</p>
<ul>
<li>
<strong>auc</strong> Call <code><a href="../reference/makeAUC.html">makeAUC()</a></code> to calculate the area under the curve from the simulated data.</li>
<li>
<strong>pta</strong> Call <code>makePTA()</code> to perform a probability of target attainment analysis with the simulated data.</li>
<li>
<strong>plot</strong> Call <code><a href="../reference/plot.PM_sim.html">plot.PM_sim()</a></code> to plot the simulated data.</li>
<li>
<strong>summary</strong> Summarize any data field with or without grouping.</li>
<li>
<strong>save</strong> Save the simulation to your hard drive as an .rds file. Load a previous one by providing the filename as the argument to <code>PM_sim$new()</code>.</li>
<li>
<strong>clone</strong> Copy a simulation result.</li>
</ul>
<p>All of these are detailed further in <code><a href="../reference/PM_sim.html">PM_sim()</a></code>.To apply them to one of the simulations when there are multiple, use <code>at</code> followed by additional arguments to the method to choose the simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim1</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>at <span class="op">=</span> <span class="fl">2</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="level2 unnumbered" data-number="6"><h2 class="unnumbered" data-number="6" id="citations">
<span class="header-section-number">6</span> Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-goutelle_nonparametric_2022" class="csl-entry" role="listitem">
Goutelle, Sylvain, Jean‐Baptiste Woillard, Michael Neely, Walter Yamada, and Laurent Bourguignon. 2022. <span>“Nonparametric <span>Methods</span> in <span>Population</span> <span>Pharmacokinetics</span>.”</span> <em>The Journal of Clinical Pharmacology</em> 62 (2): 142–57. <a href="https://doi.org/10.1002/jcph.1650" class="external-link">https://doi.org/10.1002/jcph.1650</a>.
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Neely, Julián Otálvaro, Markus Hößvd.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
