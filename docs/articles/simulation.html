<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Pmetrics">
<title>Simulation • Pmetrics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Simulation">
<meta property="og:description" content="Pmetrics">
<meta property="og:image" content="https://lapkb.github.io/Pmetrics/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro.html">Introduction</a>
    <a class="dropdown-item" href="../articles/overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/workflow.html">Workflow</a>
    <a class="dropdown-item" href="../articles/data.html">Data Inputs</a>
    <a class="dropdown-item" href="../articles/models.html">Model Inputs</a>
    <a class="dropdown-item" href="../articles/simulation.html">Simulation</a>
    <a class="dropdown-item" href="../articles/plotly.html">Plotly plots</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Simulation</h1>
            
      
      
      <div class="d-none name"><code>simulation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="performing-simulations">Performing Simulations<a class="anchor" aria-label="anchor" href="#performing-simulations"></a>
</h2>
<p>The Pmetrics simulator is a powerful Monte Carlo engine that is
smoothly integrated with Pmetrics inputs and outputs. Unlike NPAG and
IT2B, it is run from within R. No batch file is created or terminal
window opened. However, the actual simulator is a Fortran executable
compiled and run in an OS shell.</p>
<p><span class="r6">R6</span></p>
<p>To complete a simulator run you must include data and a model object.
These can be previously loaded objects with <code><a href="../reference/PM_data.html">PM_data()</a></code> and
<code><a href="../reference/PM_model.html">PM_model()</a></code> or loaded on the fly by specifing file names of
appropriate files in the current working directory (check with
<code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> and <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files()</a></code>), e.g., .csv for data
and .txt for models, at the time of simulation. The model dictates the
equations and the data file serves as the template specifying doses,
observation times, covariates, etc.</p>
<p>The other mandatory item is a prior probability distribution for all
random parameter values in the model. This is referenced by the
<code>poppar</code> argument, detailed below.</p>
<p>You run the simulator in two ways.</p>
<ul>
<li>Use the <code>$sim()</code> method for <code><a href="../reference/PM_result.html">PM_result()</a></code>
objects. This takes <code>poppar</code> from the
<code>PM_result$final</code> field and the model from the
<code>PM_result$model</code> field, so only a data object needs to be
specified at minimum.</li>
<li>Use <code>PM_sim()$run</code>. This takes a manually specified
values for <code>poppar</code>, <code>model</code>, and
<code>data</code>. These can be other Pmetrics objects, or de novo,
which can be useful for simulating from models reported in the
literature.</li>
</ul>
<p><span class="legacy">Legacy</span></p>
<p>To complete a simulator run you must include the names of a data and
a model file in the working directory. The only way to run the simulator
is with <code><a href="../reference/SIMrun.html">SIMrun()</a></code>. The <code>poppar</code> argument must
also be supplied.</p>
</div>
<div class="section level2">
<h2 id="model-and-data-details">Model and data details<a class="anchor" aria-label="anchor" href="#model-and-data-details"></a>
</h2>
<p>The structures of the model and data objects when used by the
simulator are identical to those used by NPAG and IT2B. Of course, the
model parameters must match the parameters in the <code>poppar</code>
argument. Any covariates must match between model and data. The data
object contains the template dosing and observation history as well as
any covariates. Observation values (the OUT column) for EVID=0 events
can be any number; they will be replaced with the simulated values.
However, do not use -99, as this will simulate a missing value, which
might be useful if you are testing the effects of such values. A good
choice for the OUT value in the simulator data template is -1 to remind
you that it is being simulated, but this choice is optional.</p>
<p>You can have any number of subject records within a data object, each
with its own covariates if applicable. Each subject will cause the
simulator to run one time, generating as many simulated profiles as you
specify from each template subject. This is controlled by the
<code>include</code>, <code>exclude</code>, and <code>nsim</code>
arguments to the simulator (see below). The first two specify which
subjects in the data object will serve as templates for simulation. The
second specifies how many profiles are to be generated from each
included subject.</p>
</div>
<div class="section level2">
<h2 id="simulation-options">Simulation options<a class="anchor" aria-label="anchor" href="#simulation-options"></a>
</h2>
<p>Details of all arguments available to modify simulations are
available by typing <code><a href="../reference/SIMrun.html">?SIMrun</a></code> into the R console. A few are
highlighted here.</p>
<p>Simulation from a non-parametric prior distribution (from NPAG) can
be done in one of two ways. The first is simply to take the mean,
standard deviation and covariance matrix of the distribution and perform
a standard Monte Carlo simulation. The second way is what we call
semi-parametric, and was devised by Goutelle et al. In this method, the
non-parametric “support points” in the population model, each a vector
of one value for each parameter in the model and the associated
probability of that set of parameter values, serve as the mean of one
multi-variate normal distribution in a multi-modal, multi-variate joint
distribution. The weight of each multi-variate distribution is equal to
the probability of the point. The overall population covariance matrix
is divided by the number of support points and applied to each
distribution for sampling.</p>
<p><img src="Images/unibv40.png"></p>
<p><img src="Images/multi-bv40.png"></p>
<p>Limits may be specified for truncated parameter ranges to avoid
extreme or inappropriately negative values. The simulator will report
values for the total number of simulated profiles needed to generate
<code>nsim</code> profiles within the specified limits, as well as the
means and standard deviations of the simulated parameters to check for
simulator accuracy.</p>
<p>Output from the simulator can be controlled by further arguments to
<span class="r6">R6</span> <code>$sim</code>, <code>$run</code> or <span class="legacy">Legacy</span> <code><a href="../reference/SIMrun.html">SIMrun()</a></code>. If
<code>makecsv</code> is not missing, a .csv file with the simulated
profiles will be created with the name as specified by
<code>makecsv</code>; otherwise, there will be no .csv file created. If
<code>outname</code> is not missing, the simulated values and parameters
will be saved in a .txt file whose name is that specified by
<code>outname</code>; otherwise the filename will be “simout”. In either
case, integers 1 to the number of subjects will be appended to outname
or “simout”, e.g. “simout1.txt”, “simout2.txt”.</p>
</div>
<div class="section level2">
<h2 id="simulation-output">Simulation output<a class="anchor" aria-label="anchor" href="#simulation-output"></a>
</h2>
<p><span class="r6">R6</span></p>
<p>Simulation output files (e.g. simout1.txt, simout2.txt) are
automatically read by <code><a href="../reference/SIMparse.html">SIMparse()</a></code> and returned as the new
<code>PM_sim</code> object that was assigned to contain the results of
the simulation. All files will remain on the hard drive.</p>
<p><span class="legacy">Legacy</span></p>
<p>Output files from the simulator can be read into R using the
<code><a href="../reference/SIMparse.html">SIMparse()</a></code> command. Note that SIMparse() returns the parsed
output of a simulator run as a PMsim object, so use the command like
this:</p>
<p><code>simdata &lt;- SIMparse(...)</code></p>
<p>so that simdata will contain the results. The arguments to SIMparse
are detailed in the help for the function: <code>?SIMparse()</code>.
<strong>NOTE</strong>: <code>combine</code> in <span class="r6">R6</span> becomes a argument to the simulator run methods,
which is passed through to <code><a href="../reference/SIMparse.html">SIMparse()</a></code>, since the parsing
function is no longer called by the user generally.</p>
</div>
<div class="section level2">
<h2 id="plotting-simulation-output">Plotting simulation output<a class="anchor" aria-label="anchor" href="#plotting-simulation-output"></a>
</h2>
<p><span class="r6">R6</span></p>
<p>Output from <code>PM_result$sim()</code> and
<code>PM_sim$run()</code> is a <code>PM_sim</code> object. The object
can be plotted with the attached plot method: <code>PM_sim$plot()</code>
which in turn calls the <code><a href="../reference/plot.PM_sim.html">plot.PM_sim()</a></code> function. See the
help for the function and <code><a href="../articles/plotly.html">vignette("plotly")</a></code> for further
details.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Neely, Julián Otálvaro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
