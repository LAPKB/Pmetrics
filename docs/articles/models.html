<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Pmetrics">
<title>Models • Pmetrics</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Models">
<meta property="og:description" content="Pmetrics">
<meta property="og:image" content="https://lapkb.github.io/Pmetrics/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Pmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LAPKB/Pmetrics/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LAPKB/Pmetrics/blob/HEAD/vignettes/models.Rmd" class="external-link"><code>vignettes/models.Rmd</code></a></small>
      <div class="d-none name"><code>models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="creating-models">Creating Models<a class="anchor" aria-label="anchor" href="#creating-models"></a>
</h2>
<p>There are three pathways to creating models in Pmetrics.</p>
<ul>
<li>Use the Pmetrics Model Builder app</li>
<li>Write a model list in R</li>
<li>Load an existing model text file</li>
</ul>
<p>Each of these use sections to define the model. In the app, the
sections correspond to tabs. In the list, they are named elements. In
the model file, they are code blocks delimited by “#” and the name of
the block. The sections are largely the same across the three model
pathways, and we’ll cover the details in this document.</p>
<div class="section level3">
<h3 id="model-builder-app">Model Builder App<a class="anchor" aria-label="anchor" href="#model-builder-app"></a>
</h3>
<p>To launch the app, type the following into your console:
<code><a href="../reference/build_model.html">build_model()</a></code>. You can supply a <code>PM_data</code> and/or
a <code>PM_model</code> as optional arguments to the function,
e.g. <code>build_model(NPex$data)</code> or
<code>build_model(NPex$model)</code> or even
<code>build_model(NPex$data, NPex$model)</code>. The order of data
and/or model arguments doesn’t matter. Pmetrics can figure out which is
which.</p>
</div>
<div class="section level3">
<h3 id="model-list">Model List<a class="anchor" aria-label="anchor" href="#model-list"></a>
</h3>
<p>You can write a Pmetrics model list in R. Blocks in the model files
which were delimited with the “#” character become lists in R6. You can
also generate a model in the app and copy it as a list to R which can be
used in <code>PM_model$new(copied_list)</code>. Once in R,
<code>PM_model</code> list objects can be updated using the
<code>$update()</code> <a href="#update-model">method</a>.</p>
</div>
<div class="section level3">
<h3 id="model-files">Model Files<a class="anchor" aria-label="anchor" href="#model-files"></a>
</h3>
<p>The format of the .txt model file has been unchanged since Pmetrics
0.4. You can write the file by hand, or use the app to create a model
and then save it to a file. Once you have a file, it can be loaded in to
R with <code>PM_model$new("file")</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"model.txt"</span><span class="op">)</span> </span>
<span><span class="co">#assumes model.txt is in working directory</span></span>
<span><span class="co">#check with list.files() and/or getwd()</span></span></code></pre></div>
<p>Saved models are only text files. You can write files directly
yourself, although it is easier and more stable to use the model
building app. We will review the format of the files in detail. In
either R6 or Legacy Pmetrics, models are ultimately translated into
Fortran text files with a header version of TSMULT...</p>
<p><strong>Naming your model files.</strong> The default model file name
is “model.txt,” but you can call them whatever you wish. However,
<strong>please keep the number of characters in the model file name ≤
8</strong>. When you use a model file in a <code>$run()</code> method,
at the end of the run, your original model file will be left where it
is, but a copy called “genmodel.txt” will be in the /inputs subfolder of
the run folder, and a “genmodel.for” Fortran model file will be in the
/etc subfolder of the run folder.</p>
<p><strong>Structure of model files.</strong> The model file is a text
file with up to 10 blocks, each marked by "#" followed by a header tag.
For each header, only the capital letters are required for recognition
by Pmetrics. The blocks can be in any order, and header names are
case-insensitive (i.e. the capitalization here is just to show which
letters are required). Fortran is also case-insensitive, so in variable
names and expressions case is ignored. We include a <a href="#completeEx">complete example</a>.</p>
<p>Important: Sometimes it is important to preserve spacing and
formatting in Fortran code that you might insert into blocks,
particularly the #EXTRA block. If you wish to do this, insert [format]
and [/format] before and after any code that you wish to reproduce
verbatim with spacing in the fortran model file.</p>
<p>Comments: You can insert comments into your model text file by
starting a line with a capital “C” followed by a space. These lines will
be removed/ignored in the final Fortran code.</p>
</div>
</div>
<div class="section level2">
<h2 id="model-sections">Model Sections<a class="anchor" aria-label="anchor" href="#model-sections"></a>
</h2>
<p>The model building app has a unique <a href="#mb-lib">Model
library</a> section not found in model files or lists.</p>
<p>Sections common to all the model building pathways include the
following:</p>
<ul>
<li><a href="#mb-pri">PRImary variables</a></li>
<li><a href="#mb-cov">COVariates</a></li>
<li><a href="#mb-sec">SECcondary variables</a></li>
<li><a href="#mb-ini">INItial conditions</a></li>
<li><a href="#mb-fa">Fa (bioavailability)</a></li>
<li><a href="#mb-lag">LAG time</a></li>
<li><a href="#mb-eqn">EQuatioNs</a></li>
<li><a href="#mb-out">OUTputs</a></li>
</ul>
<p>Lastly, sections which are specific to model files:</p>
<ul>
<li><a href="#err">ERRor</a></li>
<li><a href="#extra">EXTra</a></li>
</ul>
<div class="section level3">
<h3 id="mb-lib">Model Library<a class="anchor" aria-label="anchor" href="#mb-lib"></a>
</h3>
<p><img src="Images/model_builder/front.png" width="100%" height="100%"></p>
<p>Here you can choose from pre-existing models, either which you have
created yourself and load with the Previous Model dialogue, or from the
Pmetrics Model Library. Use the filters and description search to help
select the model you want. Matching models will update in the box at the
bottom. If you select one, you’ll see a model snapshot on the right.</p>
<p>In the snapshots, B is for bolus inputs, R is for Rate infusions
(e.g. intravenous infusions), and Y is for observations. Arrows indicate
the flow of drug. The grey compartment 0 is the environment.</p>
<p>Once you choose a model, hit the “Select” button at the bottom to
populate remaining model components. Similarly, if you load a Previous
Model, model components will be appropriately populated.</p>
</div>
<div class="section level3">
<h3 id="mb-pri">PRImary<a class="anchor" aria-label="anchor" href="#mb-pri"></a>
</h3>
<div class="section level4">
<h4 id="app">App<a class="anchor" aria-label="anchor" href="#app"></a>
</h4>
<p><img src="Images/model_builder/primary.png" width="100%" height="100%"></p>
<p>In this tab, you can choose the number and names of the primary
parameters. Variable names should be 11 characters or fewer. Some
variable names are <a href="#reserved">reserved</a> for use by Pmetrics
and cannot be used as primary variable names. <strong>The number of
primary variables must be between 2 and 32, with at most 30 random or 20
fixed.</strong></p>
<p>These are the parameters for which value probability distributions
will be estimated. You can specify initial values as ranges or mean/SD.
The mean is the mid point of a range and the SD is 1/6 of the range,
i.e. 3 SD above and below the mean. If you omit the second value for a
parameter (Max or SD), the parameter will become “fixed”, i.e. unknown
value but zero variance in the population. In other words Pmetrics will
estimate the value but make it the same for the whole population. The
value you provide will be the starting estimate. If you check the
constant option, it will fix the parameter to your value for every
subject and not estimate. The GTZ option keeps the parameter positive,
which is only relevant for parametric analysis, since nonparametric will
respect parameter ranges strictly.</p>
<p>In the bottom you see the Model Diagram and the Model List. These
dynamically build as you complete the Model Components.</p>
</div>
<div class="section level4">
<h4 id="list">List<a class="anchor" aria-label="anchor" href="#list"></a>
</h4>
<p>Primary variables are a list named “pri”, comprising named elements
which are the parameters, and the function to define the parameter, one
parameter to a line.</p>
<p>The two defining function are <code>ab</code> and <code>msd</code>.
Choose one for each parameter. The first defines the absolute search
space for that parameter for NPAG/NPOD, i.e., the range. For IT2B/RPEM,
it defines the mean of the prior as the midpoint of the range, and the
range covers 6 standard deviations, e.g. ±3 SD above and below the mean,
or 99.7% of the prior distribution. <code>msd</code> is the companion
function that specifies a mean and SD in IT2B and RPEM. For NPAG/NPOD,
it will be converted in to a range in the reverse fashion as described
for <code>ab</code>. For both specifying functions, <code>gtz</code> is
an argument to force the parameter value to be positive,
i.e. <code>gtz=T</code>, which is the default. To allow negative
parameters, set <code>gtz=F</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>      eff <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, gtz <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file">File<a class="anchor" aria-label="anchor" href="#file"></a>
</h4>
<p>Primary variables are a list of variable names, one name to a line.
On each line, following the variable name, is the range for the
parameter that defines the search space. These ranges behave slightly
differently for NPAG, IT2B, and the simulator.</p>
<ul>
<li><p>For all engines, the format of the limits is <em>min, max</em>. A
single value will indicate that the parameter is to be fixed but unknown
in the population, i.e. the value is taken as the starting point for the
optimization, but the final value will depend on the model and data and
will be the same across the population. A single value followed by an
“!” will indicate that this value is to be held constant (i.e. fixed and
known) across the population, and not to be estimated.</p></li>
<li><p>For <strong>NPAG</strong>, when <em>min, max</em> limits are
specified, they are absolute, i.e. the algorithm will not search outside
this range.</p></li>
<li><p>For <strong>IT2B</strong>, the range defines the Bayesian prior
distribution of the parameter values for cycle 1. For each parameter,
the mean of the Bayesian prior distribution is taken as the middle of
the range, and the standard deviation is <em>xsig</em>*range (see <a href="%5Cl"><u>IT2B runs</u></a>). Adding a plus sign (+) to a line will
prevent that parameter from being assigned negative values. NPAG and the
simulator will ignore the pluses as the ranges are absolute for these
engines. Note that prior to version 1.5.0, this used to be an
exclamation point (!) but to be consistent throughout the model file,
the exclamation point is now used when fixed values are
desired.</p></li>
<li><p>The <strong>simulator</strong> will ignore the ranges with the
default value of NULL for the <em>limits</em> argument. If the simulator
<em>limits</em> argument is set to NA, which will mean that these ranges
will be used as the limits to truncate the simulation (see <a href="%5Cl"><u>Simulator Runs</u></a>).</p></li>
</ul>
Example:
<div class="script">
<p>#Pri<br>
KE, +0, 5<br>
V, 0.01, 100<br>
KA, 0, 5<br>
KCP, 5<br>
KPC, 0 , 5<br>
Tlag1, 0, 2<br>
IC3, 0, 10000<br>
FA1, 0.5!</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mb-cov">COVariates<a class="anchor" aria-label="anchor" href="#mb-cov"></a>
</h3>
<p>Covariates are subject-specific data, such as body weight, contained
in the data .csv file. The covariate names, which are the column names
in the data file, must be declared, even if not used in the model
object. Once declared, they can be used in secondary variable and
differential equations. The order and names should be the same as in the
data file.</p>
<p>Covariates are applied at each dose event. The first dose event for
each subject must have a value for every covariate in the data file. To
change a covariate value at a time other than a dose, enter a dose event
with dose amount of zero.</p>
<p>By default, missing covariate values for subsequent dose events are
linearly interpolated between existing values, or carried forward if the
first value is the only non-missing entry. However, you can suppress
interpolation and carry forward the previous value in a piece-wise
constant fashion, depending on the way you define the model as described
below.</p>
<div class="section level4">
<h4 id="app-1">App<a class="anchor" aria-label="anchor" href="#app-1"></a>
</h4>
<p><img src="Images/model_builder/covariates.png" width="100%" height="100%"></p>
<p>If you launch the Model Builder with a <code>PM_data</code> object as
an argument, the covariate tab will be pre-populated with the covariates
in the data file, as above. The same is true if you include a
<code>PM_model</code> object as an argument to
<code><a href="../reference/build_model.html">build_model()</a></code>. If you include both, the covariates in the
<code>PM_data</code> object will take precedence. You can select any of
them to make them piece-wise constant, i.e. the value is held constant
between measurements. If left unchecked, covariate values will be
linearly interpolated between measurements.</p>
</div>
<div class="section level4">
<h4 id="list-1">List<a class="anchor" aria-label="anchor" href="#list-1"></a>
</h4>
<p>Covariates are a list of objects returned by the
<code>covariate()</code> function. The first argument for the function
is the quoted name of the covariate, and the second argument is
<code>constant</code>, which is <code>FALSE</code> by by default. This
means that missing covariate values for subsequent dose events are
linearly interpolated between existing values, or carried forward if the
first value is the only non-missing entry. Set this argument to
<code>TRUE</code> to make a covariate piece-wise constant.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span>,</span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"age"</span>, constant <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file-1">File<a class="anchor" aria-label="anchor" href="#file-1"></a>
</h4>
<p>List the covariates by name, one per line in the #COV block. To make
a covariate piece-wise constant, include an exclamation point (!) in the
declaration line.</p>
<p><strong>Note</strong> that any covariate relationship to any
parameter may be described as the user wishes by mathematical equations
and Fortran code, allowing for exploration of complex, non-linear,
time-dependent, and/or conditional relationships. This is accomplished
in the <a href="#mb-sec">#Sec</a> block.</p>
<p>Example:</p>
<div class="script">
<p>#Cov<br>
wt<br>
cyp<br>
IC!</p>
</div>
<p>where IC will be piece-wise constant and the other two will be
linearly interpolated for missing values.</p>
</div>
</div>
<div class="section level3">
<h3 id="mb-sec">Secondary<a class="anchor" aria-label="anchor" href="#mb-sec"></a>
</h3>
<p>Secondary variables are those that are defined by equations that are
combinations of primary, covariates, and other secondary variables.
Pmetrics does NOT generate distributions for the values of secondary
variables. They are only used internally to define the model.</p>
<div class="section level4">
<h4 id="app-2">App<a class="anchor" aria-label="anchor" href="#app-2"></a>
</h4>
<p><img src="Images/model_builder/secondary.png" width="100%" height="100%"></p>
<p>If using secondary variables, define them first within this tab.
Equation syntax for Secondary equations must be Fortran. It is
permissible to have conditional statements, but because expressions in
this block are translated into variable declarations, expressions other
than of the form “X = function(Y)” must be on a new line, prefixed by
“&amp;” and contain only variables which have been previously defined in
the Primary, Covariate, or Secondary blocks.</p>
<p>The image shows examples of secondary variable declarations without
conditions. Here are two examples of conditional secondary variables
chosen on the basis of sex. The primary variables are Vm, Vf, CLm, and
CLf.</p>
<pre><code>V = Vm
&amp;IF(sex == 1) V = Vf

V = Vm
CL = CLm
&amp;IF(sex == 1) THEN
V = Vf
CL = CLF
ENDIF</code></pre>
</div>
<div class="section level4">
<h4 id="list-2">List<a class="anchor" aria-label="anchor" href="#list-2"></a>
</h4>
<p>Specify each variable equation as a character vector in the same way
as for the app. In the example below, V0 is the primary parameter which
will be estimated, but internally, the model uses V as V0*wt, unless age
is &gt;18, in which case weight is capped at 75 kg. It’s the same for
CL0. Note that the conditional statement is not named.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      CL0 <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V0 <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>      eff <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, gtz <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span>,</span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"V = V0*wt"</span>,</span>
<span>      <span class="st">"&amp;IF(age &gt;18) V = V0 * 75"</span>,</span>
<span>      <span class="st">"CL = CL0 * wt"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file-2">File<a class="anchor" aria-label="anchor" href="#file-2"></a>
</h4>
<p>Format is the same as for the app.</p>
<p>Example:</p>
<div class="script">
<p>#Sec<br>
CL = Ke * V * wt**0.75<br>
&amp; IF(cyp .GT. 1) CL = CL * cyp</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mb-ini">INItial conditions<a class="anchor" aria-label="anchor" href="#mb-ini"></a>
</h3>
<p>By default, all model compartments have zero amounts at time 0.
However, you can change the default initial condition of any compartment
from 0 to something else. It can be an equation, primary or secondary
variable, or covariate.</p>
<div class="section level4">
<h4 id="app-3">App<a class="anchor" aria-label="anchor" href="#app-3"></a>
</h4>
<p>We’ll discuss more about the interface in the section on <a href="#mb-lag">lag times</a>.</p>
</div>
<div class="section level4">
<h4 id="list-3">List<a class="anchor" aria-label="anchor" href="#list-3"></a>
</h4>
<p>Initial conditions can be changed using a character vector named
“ini”. Each line of the vector specifies the compartment amount as “X[.]
= expression”, where “.” is the compartment number. Primary and
secondary variables and covariates may be used in the expression, as can
conditional statements in Fortran code. An “&amp;” continuation prefix
is not necessary in this block for any statement, although if present,
will be ignored.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      IC3 <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"wt"</span><span class="op">)</span>,</span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>,</span>
<span>      <span class="fu">covariate</span><span class="op">(</span><span class="st">"IC2"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    ini <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"X[1] = IC2*V"</span>,</span>
<span>      <span class="st">"X[3] = IC3"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the example above, IC is a covariate with the measured trough
concentration prior to an observed dose and IC3 is a fitted primary
parameter specifying an initial amount in unobserved compartment 3.</p>
<p>In the first case, the initial condition for compartment 2 becomes
the value of the IC covariate (defined in <code>cov</code> list)
multiplied by the current estimate of V during each iteration. This is
useful when a subject has been taking a drug as an outpatient, and comes
in to the lab for PK sampling, with measurement of a concentration
immediately prior to a witnessed dose, which is in turn followed by more
sampling. In this case, IC or any other covariate can be set to the
initial measured concentration, and if V is the volume of compartment 2,
the initial condition (amount) in compartment 2 will now be set to the
measured concentration of drug multiplied by the estimated volume for
each iteration until convergence.</p>
<p>In the second case, the initial condition for compartment 3 becomes
another variable, IC3 defined in the <code>pri</code> list, to fit in
the model, given the observed data.</p>
</div>
<div class="section level4">
<h4 id="file-3">File<a class="anchor" aria-label="anchor" href="#file-3"></a>
</h4>
<p>The same example as for the list above is shown below in the format
for the file.</p>
<div class="script">
<p>#Ini<br>
X(2) = IC*V<br>
X(3) = IC3<br></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mb-fa">FA (bioavailability)<a class="anchor" aria-label="anchor" href="#mb-fa"></a>
</h3>
<p>In this tab you can change the default bioavailability of any bolus
input from 1 to something else. It can be an equation, primary or
secondary variable, or covariate.</p>
<div class="section level4">
<h4 id="app-4">App<a class="anchor" aria-label="anchor" href="#app-4"></a>
</h4>
<p>We’ll discuss more about the interface in the section on <a href="#mb-lag">lag times</a>.</p>
</div>
<div class="section level4">
<h4 id="list-4">List<a class="anchor" aria-label="anchor" href="#list-4"></a>
</h4>
<p>Bioavailability for any bolus input can be changed from the default
value of 1. Use a character vector named “fa” where each line is of the
form “FA[.] = expression”, and “.” is the input number. Primary and
secondary variables and covariates may be used in the expression, as can
conditional statements in Fortran code. An “&amp;” continuation prefix
is not necessary in this block for any statement, although if present,
will be ignored.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      FA1 <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"FA[1] = FA1"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file-4">File<a class="anchor" aria-label="anchor" href="#file-4"></a>
</h4>
<p>The same example as for the list above is shown below in the format
for the file.</p>
<div class="script">
<p>#Fa<br>
FA(1) = FA1</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mb-lag">LAG time<a class="anchor" aria-label="anchor" href="#mb-lag"></a>
</h3>
<p>The lag time is a delay in absorption for a bolus input.</p>
<div class="section level4">
<h4 id="app-5">App<a class="anchor" aria-label="anchor" href="#app-5"></a>
</h4>
<p><img src="Images/model_builder/lag.png" width="100%" height="100%"></p>
<p>You can change the default delay in absorption of any bolus input
from 0 to something else. It can be an equation, primary or secondary
variable, or covariate. If you wish to use any of the latter three,
select them from the drop down and the equation will pre-populate, as
shown in the image. You can edit the equation or write your own
equation. This is true for initial conditions and bioavailability in
their tabs.</p>
</div>
<div class="section level4">
<h4 id="list-5">List<a class="anchor" aria-label="anchor" href="#list-5"></a>
</h4>
<p>Use a character vector named “lag” where each element of the vector
is of the form “LAG[.] = expression”, where “.” is the input number.
Primary and secondary variables and covariates may be used in the
expression, as can conditional statements in Fortran code. An “&amp;”
continuation prefix is not necessary in this block for any statement,
although if present, will be ignored.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      lag1 <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"LAG[1] = lag1"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file-5">File<a class="anchor" aria-label="anchor" href="#file-5"></a>
</h4>
<p>The same example as for the list above is shown below in the format
for the file.</p>
<div class="script">
<p>#Lag<br>
TLAG(1) = Tlag1</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mb-eqn">EQuatioNs<a class="anchor" aria-label="anchor" href="#mb-eqn"></a>
</h3>
<p>These are the equations that define the structural model, i.e., the
mathematical expressions that relate input (dose) to output
(measurements). Pmetrics has a library of models with algebraic
solutions and models can also use differential equations in a format
compatible with R. Even algebraic models will contain differential
equations for purposes of understanding and plotting the model, but
algebraic models from the library include a token which tells Pmetrics
how to choose the correct model. Details below.</p>
<div class="section level4">
<h4 id="app-6">App<a class="anchor" aria-label="anchor" href="#app-6"></a>
</h4>
<p><img src="Images/model_builder/eqn.png" width="100%" height="100%"></p>
<p>If you have not loaded a prior model file or selected a model from
the library, you can write the differential equations here.
<strong>There can be a maximum of 20 such equations.</strong> The model
diagram will update as information in the equations becomes
available.</p>
<p>Use <code>dX[i]</code> for change in compartment amounts, where i is
the compartment number, e.g. dX[1] or dX[2]. Compartment amounts are
referred to as <code>X[i]</code>, e.g. X[1] or X[2]. Use
<code>BOLUS[j]</code> for bolus input j and <code>RATEIV[k]</code> for
infusion k. The indeces j and k correspond to the INPUT column in the
data file, which is usually omitted and assumed to be 1 for all doses.
These can be abbreviated as “BOL[j]” or “B[j]”, for a bolus or “R[k]”
for an infusion. The duration of the infusion and total dose is defined
in the data.csv file. <strong>Up to 7 inputs are currently
allowed.</strong> The <em>DUR</em> column in the data file determines
whether a dose is treated as a BOLUS (DUR = 0) or RATEIV (DUR &gt; 0).
Any variable defined in PRI, COV, or SEC may be used in your
equations.</p>
<p>If you build an algebraic model in the app by choosing it from the
model library and save the file, it will contain an #EQN block, with a
token to indicate that the model will be solved algebraically. The
differential equations in this case are included only for information
purposes and to enable plotting of the model. The format of the
algebraic token is four comma-separated arrays, each surrounded by “[]”
and named “P” for parameters in alpha order, “B” for bolus input
compartments, “R” for rate (IV) input compartments, and “O” for output
compartments. For example, “{algebraic: P[Ka,Ke,V], B[1], R[2], O[2]}”
or “{algebraic: P[Ke,KCP,KPC,V], B[0], R[1], O[1]}”. <span class="update">Update</span>Eventually the tokens will also recognize
model names familiar to many pharmacometricians such as {algebraic:
ADVAN1 TRANS1} for {algebraic: P[Ke,V], B[0], R[1], O[1]}.</p>
<p><strong>Note:</strong> If you change the equations of an algebraic
model loaded from the library, you will receive a warning in the app
that you are forcing use of ODE solvers, and your model list (and file)
will no longer have the algebraic token. Beware also of changing the
parameter names, as the algebraic models must use specifically named
parameters. However, it is perfectly acceptable to add parameters,or
even change primary parameters as long as the original appear in the
secondary block. For example, if you wish to make volume dependent on
weight, change <code>V</code> in the Primary section to something like
<code>V0</code> with appropriate range or mean/SD, and add
<code>V = V0 * wt</code> to your Secondary section, assuming you have a
covariate named “wt”. Because <code>V</code> is still defined, Pmetrics
will know how to solve the algebraic model.</p>
</div>
<div class="section level4">
<h4 id="list-6">List<a class="anchor" aria-label="anchor" href="#list-6"></a>
</h4>
<p>Specify a model as a character vector named “eqn” with each element
an ordinary differential equation in the same R format as for the app.
Additional equations can be included.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PM_model.html">PM_model</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ka <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="fu">msd</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>      Kcp <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>      Kpc <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    eqn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"ktotal = Ke + Kcp"</span>,</span>
<span>      <span class="st">"dX[1] = BOLUS[1] -Ka * X[1]"</span>,</span>
<span>      <span class="st">"dX[2] = RATEIV[1] + Ka * X[1] - (ktotal) * X[2] + Kpc * X[3]"</span>,</span>
<span>      <span class="st">"dX[3] = Kcp * X[2] - Kpc * X[3]"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="file-6">File<a class="anchor" aria-label="anchor" href="#file-6"></a>
</h4>
<p>This block was formerly called “#DIF”, and Pmetrics will recognize
this header, but we encourage you to adopt the more general #EQN block
name.</p>
<p>Example:</p>
<div class="script">
<p>#EQN<br>
ktotal = Ke + KCP<br>
dX[1] = BOLUS[1] -KA*X[1]<br>
dX[2] = RATEIV[1] + KA*X[1] - (ktotal)*X[2] + KPC*X[3]<br>
dX[3] = KCP*X[2] - KPC*X[3]</p>
</div>
<p>Pmetrics will still recognize the old Fortran format of XP(1), which
is dX[1], and X(1), which is X[1], but please transition to the new
format to be more compatible with R and eventual transition away from
Fortran.</p>
</div>
</div>
<div class="section level3">
<h3 id="mb-out">Outputs<a class="anchor" aria-label="anchor" href="#mb-out"></a>
</h3>
<p>The outputs in Pmetrics are the values in the <em>OUT</em> column of
the data that you are trying to predict. In the model objects, each
output is referred to as <code>Y[.]</code>, where “.” is the number of
the output and the same as the corresponding <em>OUTEQ</em> in the data.
Outputs can be defined as mathematical combinations of compartment
amounts (<code>X[.]</code>), primary and/or secondary parameters, or
covariates.</p>
<p>Output equations are in R format. However, if they include
conditional statements, these should follow Fortran conventions,
e.g. with <code>IF()</code> and <code>ENDIF</code> rather than R’s
<code>if(){}</code> convention. An “&amp;” continuation prefix is not
necessary in this block for any statement, although if present, will be
ignored. <strong>There can be a maximum of 6 outputs.</strong></p>
<p>Because outputs are measurements, they have an associated error in
that measurement. Pmetrics takes this into account by partitioning model
residual prediction error into a fixed portion defined by the assay
error, which may be inflated by an additive model error component <span class="math inline">\(\lambda\)</span> or a proportional component <span class="math inline">\(\gamma\)</span>, which reflect additional noise
and model misspecification. The remaining error is random.</p>
<p>In the app and list, the error is defined with each output. In the
file, the error block is distinct from but correlates with the output
block.</p>
<div class="section level4">
<h4 id="app-7">App<a class="anchor" aria-label="anchor" href="#app-7"></a>
</h4>
<p><img src="Images/model_builder/output.png" width="100%" height="100%"></p>
<p>On this tab, you can choose the number of output equations and define
the equation for each output. You do not need to specify “Y[.] =” in the
equations. Simply include the right side of the equation in the
field.</p>
<p>Include the <strong>Assay Error</strong> polynomial coefficients for
each output equation. The four coefficients estimate SD according to the
folowing equation: <span class="math inline">\(C0 + C1 * [obs] + C2 *
[obs]^2 + C3 * [obs]^3\)</span> and <span class="math inline">\([obs]\)</span> is the observation. The values for
the coefficients should ideally come from the analytic lab in the form
of inter-run standard deviations or coefficients of variation at
standard concentrations. You can use the Pmetrics function
<code><a href="../reference/makeErrorPoly.html">makeErrorPoly()</a></code> to choose the best set of coefficients that
fit the data from the laboratory. Alternatively, you can use a generic
set of coefficients. We recommend that as a start, <span class="math inline">\(C0\)</span> be set to half of the lowest
concentration in the dataset and <span class="math inline">\(C1\)</span>
be set to 0.1. <span class="math inline">\(C2\)</span> and <span class="math inline">\(C3\)</span> can be 0.</p>
<p>If you check the <em>Use Always?</em> box, the model coefficients
will be used regardless of what is in the data file. Leaving it
unchecked, which is the default, means that coefficients in the data
file will be used if present, and the ones here in the model definition
will be used only if none are available for an observation in the
data.</p>
<p>Choose your <strong>Model Error</strong> model from the drop down.
The additive <span class="math inline">\(\lambda\)</span> and
proportional <span class="math inline">\(\gamma\)</span> models both
have fixed options. If not fixed, the parameter will be estimated,
starting from the number in the <em>Value</em> field. If fixed, it will
be held constant at the number in the <em>Value</em> field.</p>
<p>The proportional model weights each observation by <span class="math inline">\(1/(\gamma * SD)^2\)</span>, where <span class="math inline">\(\gamma\)</span> is either fixed or estimated. The
additive model weights each observation by <span class="math inline">\(1/(\lambda + SD)^2\)</span>, where <span class="math inline">\(\lambda\)</span> is either fixed or estimated. The
combination model uses <span class="math inline">\(1/((\gamma * SD)^2 +
(\lambda + SD)^2)\)</span>.</p>
<p>In the proportional model, <span class="math inline">\(\gamma\)</span> is a scalar on assay SD. In
general, well-designed and executed studies and models with low
mis-specification will have data with <span class="math inline">\(\gamma\)</span> values approaching 1. Values &lt;1
suggest over-inflated assay noise. Poor quality, noisy data will result
in <span class="math inline">\(\gamma\)</span> of 5 or more. A good
starting value for <span class="math inline">\(\gamma\)</span> is
usually 5, and sometimes 10 early in model development if data are
particularly complex or noisy.</p>
<p>In the additive model, <span class="math inline">\(\lambda\)</span>
is additive to assay SD. In general, well-designed and executed studies
and models with low mis-specification will have data with <span class="math inline">\(\lambda\)</span> values approaching 0. Values of 0
may suggest over inflated assay noise. Poor quality, noisy data will
result in <span class="math inline">\(\lambda\)</span> of <span class="math inline">\(5*C0\)</span> or more. A good starting value for
<span class="math inline">\(\lambda\)</span> is usually <span class="math inline">\(3*C0\)</span>. Note, that <span class="math inline">\(C0\)</span> should generally not be 0, as it
represents machine noise (e.g. HPLC or mass spectrometer) that is always
present.</p>
</div>
<div class="section level4">
<h4 id="list-7">List<a class="anchor" aria-label="anchor" href="#list-7"></a>
</h4>
<p>The <code>out</code> list is a series of nested lists. The outer list
defines all the outputs. The next level defines each output equation,
named as <code>Y1</code>, <code>Y2</code>, etc. Within the equation list
is the equation and the error model. Within the error model for that
output, is the last list comprising model and assay error
specifications. In the examples below, we build this nested list
structure gradually to make it more clear.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output equation is a character vector named “val” followed by an
error list.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    val <span class="op">=</span> <span class="st">"X[1]/V"</span>,</span>
<span>    err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The error model for an output equation has two elements. The first is
the <code>model</code> error, which can be one of two functions:
<code>proportional</code> for <span class="math inline">\(\gamma\)</span> or <code>additive</code> for <span class="math inline">\(\lambda\)</span>. The arguments to these functions
are a number and optionally <code>fixed</code>, which defaults to
<code>FALSE</code>. If <code>fixed</code> is <code>FALSE</code>, the
number serves as the starting estimate for the model error. If
<code>fixed</code> is <code>TRUE</code>, the number serves as the model
error, with no estimation. Note that you can only fix the additive model
currently to zero.</p>
<p>The second element is the <code>assay</code> error model. It is a
function <code>errorPoly(coeffs, constant = FALSE)</code>. The first
argument <code>coeff</code> is the vector of 4 numbers that defines a
polynomial equation to permit calculation of the standard deviation of
an observation, based on the noise of the assay. The second argument
<code>constant</code> is <code>FALSE</code> by default, which means that
coefficients in the data file will be used if present, and the ones here
in the model definition will be used only if none are available for an
observation in the data. If <code>constant = TRUE</code>, the model
coefficients will be used regardless of what is in the data file.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  Y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    val <span class="op">=</span> <span class="st">"X(1)/V"</span>,</span>
<span>    err <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="fu">proportional</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      assay <span class="op">=</span> <span class="fu">errorPoly</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="at">Y1 =</span> <span class="fu">list</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="at">val =</span> <span class="st">"X(1)/V"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="at">err =</span> <span class="fu">list</span>(</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>      <span class="at">model =</span> <span class="fu">additive</span>(<span class="dv">1</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>      <span class="at">assay =</span> <span class="fu">errorPoly</span>(<span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    )</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  )</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>)</span></code></pre></div>
<p>More complete examples.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>mod <span class="ot">&lt;-</span> PM_model<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="at">pri =</span> <span class="fu">list</span>(</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>      <span class="at">Ke =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>      <span class="at">V =</span> <span class="fu">msd</span>(<span class="dv">100</span>, <span class="dv">30</span>),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    ),</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="at">out =</span> <span class="fu">list</span>(</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>      <span class="at">y1 =</span> <span class="fu">list</span>(</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        <span class="at">val =</span> <span class="st">"X(1)/V"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        <span class="at">err =</span> <span class="fu">list</span>(</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>          <span class="at">model =</span> <span class="fu">proportional</span>(<span class="dv">5</span>),</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>          <span class="at">assay =</span> <span class="fu">errorPoly</span>(<span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>        )</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>      )</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>    )</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  )</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>)</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> PM_model<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>    <span class="at">pri =</span> <span class="fu">list</span>(</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>      <span class="at">kin =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>      <span class="at">kout =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>      <span class="at">tpd =</span> <span class="fu">ab</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>      <span class="at">V =</span> <span class="fu">msd</span>(<span class="dv">100</span>, <span class="dv">30</span>),</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>    ),</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>    <span class="at">sec =</span> <span class="fu">c</span>(</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a>      <span class="st">"RES = B(1) * KIN/(KIN-KOUT) * (EXP(-KOUT*TPD)-EXP(-KIN*TPD))"</span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>    ),</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>    <span class="at">out =</span> <span class="fu">list</span>(</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>      <span class="at">y1 =</span> <span class="fu">list</span>(</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>        <span class="at">val =</span> <span class="st">"RES/V"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>        <span class="at">err =</span> <span class="fu">list</span>(</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>          <span class="at">model =</span> <span class="fu">combination</span>(<span class="fl">0.4</span>, <span class="dv">3</span>) <span class="co">#additive, proportional</span></span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>          <span class="at">assay =</span> <span class="fu">errorPoly</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.15</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>        )</span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>      )</span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>    )</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>  )</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>)</span></code></pre></div>
<p>This last example is known as the Bateman equation for a model with
linear absorption (KIN) into and elimination (KOUT) from a central
compartment, and a time post-dose (TPD) or lag time. Here B(1) is the
oral bolus dosing vector for drug 1, and V is the volume of the central
compartment.</p>
</div>
<div class="section level4">
<h4 id="file-7">File<a class="anchor" aria-label="anchor" href="#file-7"></a>
</h4>
<p>Outputs are of the form Y[.] = expression, where "." is the output
equation number. Primary and secondary variables and covariates may be
used in the expression, as can conditional statements in Fortran code.
An "&amp;" continuation prefix is not necessary in this block for any
statement, although if present, will be ignored. <strong>There can be a
maximum of 6 outputs.</strong> They are referred to as Y[1], Y[2], etc.
These equations may also define a model explicitly as a function of
primary and secondary variables and covariates.</p>
<p>As mentioned previously, in the file method of model definition,
assay and model error are defined in a separate <a href="#err">#Err</a>
block.</p>
<p>Examples:</p>
<div class="script">
<p>#Out<br>
Y[1] = X[2]/V</p>
</div>
<p>Again, Pmetrics will recognize the older format Y(1), which is Y[1],
but users are encouraged to adopt the newer format.</p>
<p>Here’s an example of an explicit model defined in the output and not
the equation block.</p>
<div class="script">
<p>#OUT<br></p>
<p>RES = BOLUS[1] * KIN/(KIN-KOUT) *
(EXP(-KOUT*TPD)-EXP(-KIN*TPD))<br>
Y[1] = RES/VD</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="err">Error<a class="anchor" aria-label="anchor" href="#err"></a>
</h3>
<div class="section level4">
<h4 id="app-list">App, List<a class="anchor" aria-label="anchor" href="#app-list"></a>
</h4>
<p>The error section in the app and list forms of model definitions is
included with the outputs.</p>
</div>
<div class="section level4">
<h4 id="file-8">File<a class="anchor" aria-label="anchor" href="#file-8"></a>
</h4>
<p>Unlike the R6 model builder app or model list, the error block in the
file is separated from the output block. This is to maintain backward
compatibility with Legacy Pmetrics.</p>
<p>To specify the model in this block, the first line is either L=number
or G=number for a <span class="math inline">\(\lambda\)</span> or <span class="math inline">\(\gamma\)</span> error model. The number is the
starting value for <span class="math inline">\(\lambda\)</span> or <span class="math inline">\(\gamma\)</span>. If you include an exclamation
point (!) in the declaration, then <span class="math inline">\(\lambda\)</span> or <span class="math inline">\(\gamma\)</span> will be fixed and not estimated.
Recall that you can only fix <span class="math inline">\(\lambda\)</span> currently to zero.</p>
<p>The next line(s) contain the values for the assay error polynomial
coefficients: <span class="math inline">\(C0\)</span>, <span class="math inline">\(C1\)</span>, <span class="math inline">\(C2\)</span>, and <span class="math inline">\(C3\)</span>, separated by commas. There should be
one line of coefficients for each output equation. By default Pmetrics
will use values for these coefficients found in the data file. If none
are present or if the model declaration line contains an exclamation
point (!) the values here will be used.</p>
<p>Example 1: estimated <span class="math inline">\(\lambda\)</span>,
starting at 0.4, one output, use data file coefficients but if missing,
use 0.1,0.1,0,0.</p>
<div class="script">
<p>#Err<br>
L=0.4<br>
0.1,0.1,0,0<br></p>
</div>
<p>Example 2: fixed <span class="math inline">\(\gamma\)</span> of 2,
two outputs, use data file coefficients but if missing, use 0.1,0.1,0,0
for the first output, but use 0.3, 0.1, 0, 0 for output 2 regardless of
what is in the data file.</p>
<div class="script">
<p>#Err<br>
G=2!<br>
0.1,0.1,0,0<br>
0.3,0.1,0,0!<br></p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="extra">Extra<a class="anchor" aria-label="anchor" href="#extra"></a>
</h3>
<div class="section level4">
<h4 id="app-list-1">App, List<a class="anchor" aria-label="anchor" href="#app-list-1"></a>
</h4>
<p>This block is not currently implemented in either the app or list
forms.</p>
</div>
<div class="section level4">
<h4 id="file-9">File<a class="anchor" aria-label="anchor" href="#file-9"></a>
</h4>
<p>This block is for advanced Fortran programmers only. &lt;span
class=“update&gt;Update. Occasionally, for very complex models,
additional Fortran subroutines are required. They can be placed here.
The code must specify complete Fortran subroutines which can be called
from other blocks with appropriate call functions. As stated earlier,
sometimes it is important to preserve spacing and formatting in Fortran
code that you might insert into blocks, particularly the #EXTRA block.
If you wish to do this, insert [format] and [/format] in the fortran
model file around the affected code.</p>
</div>
</div>
<div class="section level3">
<h3 id="completeEx">Complete File Example<a class="anchor" aria-label="anchor" href="#completeEx"></a>
</h3>
<p>Here is a complete example of a model file, as of Pmetrics version
2.1 and higher:</p>
<div class="script">
<p>#Pri<br>
KE, 0, 5<br>
V0, 0.1, 100<br>
KA, 0, 5<br>
Tlag1, 0, 3<br></p>
<p>#Cov<br>
wt<br>
C this weight is in kg<br></p>
<p>#Sec<br>
V = V0*wt<br></p>
<p>#Lag<br>
TLAG[1] = Tlag1<br></p>
<p>#Out<br>
Y[1] = X[2]/V<br></p>
<p>#Err<br>
L=0.4<br>
0.1,0.1,0,0<br></p>
</div>
<p><em>Notes</em>:</p>
<p>By omitting a #EQN block with ODEs, Pmetrics understands that you are
specifying the model to be solved algebraically. In this case, at least
KE and V must be in the Primary or Secondary variables. KA, KCP, and KPC
are optional and specify absorption, and transfer to and from the
central to a peripheral compartment, respectively.</p>
<p>As described above, if you build the same algebraic model in the app
and save the file, it will contain an #EQN block, with a token to
indicate that the model will be solved algebraically and differential
equations only for information purposes and to enable plotting of the
model.</p>
<p>The comment line “C this weight is in kg” will be ignored.</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-and-copying-models-from-the-app">Saving and copying models from the app<a class="anchor" aria-label="anchor" href="#saving-and-copying-models-from-the-app"></a>
</h2>
<p><img src="Images/model_builder/output2.png" width="100%" height="100%"></p>
<p>The Model List tab in the bottom window of the app shows the List
form of the model. You can see it develop as you complete components.
Once the model is finished, you can use one or both of the buttons at
the bottom to copy or save the model.</p>
<p>Choosing <em>Copy</em> will put the code in you clipboard and you can
paste it into R. It will include <code>PM_model$new(...)</code>, so you
should add code such as <code>mod1 &lt;-</code> to your R script, and
then paste. This will entirely define <code>mod1</code> as a
<code>PM_model</code> equivalent to what you built in the app.</p>
<p>Choosing <em>Save</em> in the app will write a file named “model.txt”
to your current working directory in R that contains all the code
necessary to define the same model as you build in the app. Be aware
that if there is another file named “model.txt” in your working
directory, it will be overwritten.</p>
<p>While incomplete models can be copied, a model can only be saved when
it is complete. It is necessary for you to at least open relevant
components to ensure that all fields are finalized in the Model List
before you can save it.</p>
</div>
<div class="section level2">
<h2 id="update-model">Updating models<a class="anchor" aria-label="anchor" href="#update-model"></a>
</h2>
<div class="section level3">
<h3 id="app-8">App<a class="anchor" aria-label="anchor" href="#app-8"></a>
</h3>
<p>You can update an existing model in one of two ways in the app:</p>
<ul>
<li>Pass the <code>PM_model</code> object to the app as an argument to
<code><a href="../reference/build_model.html">build_model()</a></code>, for example,
<code>build_model(NPex$model)</code>. Then, edit the appropriate fields
in the app. Save the model as a new model and/or copy it into R. Note
that the app saves all models as “model.txt” so be sure not to overwrite
your old model if you wish to keep it.</li>
<li>Load a previously saved model file using the dialog button in the
app and proceed as for the first option above.</li>
</ul>
</div>
<div class="section level3">
<h3 id="list-8">List<a class="anchor" aria-label="anchor" href="#list-8"></a>
</h3>
<p>Because models are loaded as memory items in R6 Pmetrics, they can be
modified in R without having to edit text files. This function is
accessed via the <code>$update()</code> method for <code>PM_model</code>
objects.</p>
<p>All R6 objects are mini-environments, so direct copies of an R6
environment are in the same environment and changes to one will change
them all. This means the following code will likely not work as
intended.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod1</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>When <em>mod2</em> is updated, <em>mod1</em> will update as they are
in the same environment. The way to create an independent copy of an R6
object, which does not share the same environment, is to use the
<code>$clone()</code> method available for all R6 objects.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="va">mod1</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>Now changes to mod2 do not propagate to mod1.</p>
<p>To update a model, simply supply the list items you wish to change
with the new values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">mod2</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    pri <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      Ke <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>      V <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      V0 <span class="op">=</span> <span class="fu">ab</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sec <span class="op">=</span> <span class="st">"V = V0 * wt"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This example changes the range of <em>Ke</em>, deletes <em>V</em>,
adds <em>V0</em>, and defines a new secondary relationship for <em>V =
V0 * wt</em>.</p>
</div>
<div class="section level3">
<h3 id="file-10">File<a class="anchor" aria-label="anchor" href="#file-10"></a>
</h3>
<p>The only way to update a model file is to edit the text file and load
it with <code>PM_model$new()</code>. The advantage is that it is quick
and relatively easy. The disadvantage is that you have to keep editing,
copying and pasting files, and unless your documentation in R or
elsewhere is good, you have no idea how you changed the model from run
to run. In contrast, by using the <code>$update()</code> method in R6,
you can see a written record of how the model evolved over the
project.</p>
</div>
</div>
<div class="section level2">
<h2 id="reserved">Reserved Names<a class="anchor" aria-label="anchor" href="#reserved"></a>
</h2>
<p>The following cannot be used as primary, covariate, or secondary
variable names. They can be used in equations, however.</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th align="left">Reserved Variable</th>
<th align="left">Function in Pmetrics</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ndim</td>
<td align="left">internal</td>
</tr>
<tr class="even">
<td align="left">t</td>
<td align="left">time</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="left">array of compartment amounts</td>
</tr>
<tr class="even">
<td align="left">xp</td>
<td align="left">array of first derivative of compartment amounts</td>
</tr>
<tr class="odd">
<td align="left">rpar</td>
<td align="left">internal</td>
</tr>
<tr class="even">
<td align="left">ipar</td>
<td align="left">internal</td>
</tr>
<tr class="odd">
<td align="left">p</td>
<td align="left">array of primary parameters</td>
</tr>
<tr class="even">
<td align="left">r</td>
<td align="left">input rates</td>
</tr>
<tr class="odd">
<td align="left">b</td>
<td align="left">input boluses</td>
</tr>
<tr class="even">
<td align="left">npl</td>
<td align="left">internal</td>
</tr>
<tr class="odd">
<td align="left">numeqt</td>
<td align="left">output equation number</td>
</tr>
<tr class="even">
<td align="left">ndrug</td>
<td align="left">input number</td>
</tr>
<tr class="odd">
<td align="left">nadd</td>
<td align="left">covariate number</td>
</tr>
<tr class="even">
<td align="left">rateiv</td>
<td align="left">intravenous input for inputs when DUR&gt;0 in data
files</td>
</tr>
<tr class="odd">
<td align="left">cv</td>
<td align="left">covariate values array</td>
</tr>
<tr class="even">
<td align="left">n</td>
<td align="left">number of compartments</td>
</tr>
<tr class="odd">
<td align="left">nd</td>
<td align="left">internal</td>
</tr>
<tr class="even">
<td align="left">ni</td>
<td align="left">internal</td>
</tr>
<tr class="odd">
<td align="left">nup</td>
<td align="left">internal</td>
</tr>
<tr class="even">
<td align="left">nuic</td>
<td align="left">internal</td>
</tr>
<tr class="odd">
<td align="left">np</td>
<td align="left">number of primary parameters</td>
</tr>
<tr class="even">
<td align="left">nbcomp</td>
<td align="left">bolus compartment array</td>
</tr>
<tr class="odd">
<td align="left">psym</td>
<td align="left">names of primary parameters</td>
</tr>
<tr class="even">
<td align="left">fa</td>
<td align="left">biovailability</td>
</tr>
<tr class="odd">
<td align="left">tlag</td>
<td align="left">lag time</td>
</tr>
<tr class="even">
<td align="left">tin</td>
<td align="left">internal</td>
</tr>
<tr class="odd">
<td align="left">tout</td>
<td align="left">internal</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="brief-fortran-tutorial">Brief Fortran Tutorial<a class="anchor" aria-label="anchor" href="#brief-fortran-tutorial"></a>
</h2>
<p>Much more detailed help is available from <a href="https://fortran-lang.org/en/learn/quickstart/" class="external-link uri">https://fortran-lang.org/en/learn/quickstart/</a>.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Arithmetic Operator</th>
<th align="left">Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">+</td>
<td align="left">addition</td>
</tr>
<tr class="even">
<td align="left">-</td>
<td align="left">subtraction</td>
</tr>
<tr class="odd">
<td align="left">*</td>
<td align="left">multiplication</td>
</tr>
<tr class="even">
<td align="left">/</td>
<td align="left">division</td>
</tr>
<tr class="odd">
<td align="left">**</td>
<td align="left">exponentiation</td>
</tr>
</tbody>
</table>
<table class="table"><tbody>
<tr class="odd">
<td align="left"><strong>Relational Operator</strong></td>
<td align="left"><strong>Alternative</strong></td>
<td align="left"><strong>Meaning</strong></td>
</tr>
<tr class="even">
<td align="left">&lt;</td>
<td align="left">.LT.</td>
<td align="left">less than</td>
</tr>
<tr class="odd">
<td align="left">&lt;=</td>
<td align="left">.LE.</td>
<td align="left">less than or equal</td>
</tr>
<tr class="even">
<td align="left">&gt;</td>
<td align="left">.GT.</td>
<td align="left">greater than</td>
</tr>
<tr class="odd">
<td align="left">&gt;=</td>
<td align="left">.GE.</td>
<td align="left">greater than or equal</td>
</tr>
<tr class="even">
<td align="left">==</td>
<td align="left">.EQ.</td>
<td align="left">equal</td>
</tr>
<tr class="odd">
<td align="left">/=</td>
<td align="left">.NE.</td>
<td align="left">not equal</td>
</tr>
</tbody></table>
<table style="width:90%;" class="table">
<colgroup>
<col width="55%">
<col width="34%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Selective Execution</strong></td>
<td><strong>Example</strong></td>
</tr>
<tr class="even">
<td>IF (logical-expression) one-statement</td>
<td>IF (T &gt;= 100) CL = 10</td>
</tr>
<tr class="odd">
<td>
<p>IF (logical-expression) THEN</p>
<p>statements</p>
<p>END IF</p>
</td>
<td>
<p>IF (T &gt;= 100) THEN</p>
<p>CL = 10</p>
<p>V = 10</p>
<p>END IF</p>
</td>
</tr>
<tr class="even">
<td>
<p>IF (logical-expression) THEN</p>
<p>statements-1</p>
<p>ELSE</p>
<p>statements-2</p>
<p>END IF</p>
</td>
<td>
<p>IF (T &gt;= 100) THEN</p>
<p>CL = 10</p>
<p>ELSE</p>
<p>CL = CL</p>
<p>END IF</p>
</td>
</tr>
</tbody>
</table>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Neely, Julián Otálvaro.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
